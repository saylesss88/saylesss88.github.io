<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>My-Nix-Blog</title>
    <!-- <link rel="stylesheet" href="https://saylesss88.github.io/style.css" /> -->
    <script>
      const baseUrl = "https://saylesss88.github.io";
    </script>
  </head>
  <body>
    <div class="container">
      <h1>Welcome to My-Nix-Blog</h1>

      <button id="dark-mode-toggle">Toggle Dark Mode</button>

      <a href="https://saylesss88.github.io/rss.xml" id="rss-button" role="button">
        ðŸ“¡ Subscribe via RSS
      </a>

      <div role="search">
        <input
          type="text"
          id="search"
          placeholder="Search..."
          aria-label="Search"
        />
        <div class="search-results" aria-live="polite">
          <ul class="search-results__items"></ul>
        </div>
      </div>

      
  &lt;h1 id=&quot;understanding-top-level-attributes-in-nixos-modules&quot;&gt;Understanding Top-Level Attributes in NixOS Modules&lt;&#x2F;h1&gt;
&lt;p&gt;&lt;strong&gt;TOC&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;!--toc:start--&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;saylesss88.github.io&#x2F;blog&#x2F;understanding-toplevel-attributes-in-nixos-modules&#x2F;#understanding-top-level-attributes-in-nixos-modules&quot;&gt;Understanding Top-Level Attributes in NixOS Modules&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;saylesss88.github.io&#x2F;blog&#x2F;understanding-toplevel-attributes-in-nixos-modules&#x2F;#how-options-relate-a-chain-of-influence&quot;&gt;How Options Relate: A Chain of Influence&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;saylesss88.github.io&#x2F;blog&#x2F;understanding-toplevel-attributes-in-nixos-modules&#x2F;#the-nixos-module-system-evaluating-options&quot;&gt;The NixOS Module System: Evaluating Options&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;saylesss88.github.io&#x2F;blog&#x2F;understanding-toplevel-attributes-in-nixos-modules&#x2F;#how-the-module-system-works-a-simplified-overview&quot;&gt;How the Module System Works: A Simplified Overview&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;!--toc:end--&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;img src=&quot;&#x2F;images&#x2F;gruv9.png&quot; alt=&quot;Cyber&quot; width=&quot;700&quot;&gt;
&lt;p&gt;This explanation is based on insights from Infinisil, a prominent figure in the
Nix community, to help clarify the concept of top-level attributes within
NixOS modules.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-core-of-a-nixos-system-system-build-toplevel&quot;&gt;The Core of a NixOS System: &lt;code&gt;system.build.toplevel&lt;&#x2F;code&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;In a NixOS system, everything is built from a single &quot;system derivation.&quot; The
command &lt;code&gt;nix-build &#x27;&amp;lt;nixpkgs&#x2F;nixos&amp;gt;&#x27; -A system&lt;&#x2F;code&gt; initiates this build process.&lt;&#x2F;p&gt;
&lt;p&gt;The &lt;code&gt;-A system&lt;&#x2F;code&gt; part tells Nix to focus on the &lt;code&gt;system&lt;&#x2F;code&gt; attribute defined in
the &lt;code&gt;&#x27;&amp;lt;nixpkgs&#x2F;nixos&amp;gt;&#x27;&lt;&#x2F;code&gt; file (which is essentially &lt;code&gt;.&#x2F;default.nix&lt;&#x2F;code&gt; within the
Nixpkgs repository).&lt;&#x2F;p&gt;
&lt;p&gt;This &lt;code&gt;system&lt;&#x2F;code&gt; attribute is specifically the NixOS option &lt;code&gt;system.build.toplevel&lt;&#x2F;code&gt;
. Think of &lt;code&gt;system.build.toplevel&lt;&#x2F;code&gt; as the &lt;strong&gt;very top of the configuration
hierarchy&lt;&#x2F;strong&gt; for your entire NixOS system. Almost every setting you configure
eventually influences this top-level derivation, often through a series of
intermediate steps.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Key Takeaway:&lt;&#x2F;strong&gt; &lt;code&gt;system.build.toplevel&lt;&#x2F;code&gt; is the ultimate output that defines your entire NixOS system.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;how-options-relate-a-chain-of-influence&quot;&gt;How Options Relate: A Chain of Influence&lt;&#x2F;h2&gt;
&lt;p&gt;Options in NixOS are not isolated; they often build upon each other. Here&#x27;s an example of how a high-level option can lead down to a low-level system configuration:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;You enable Nginx with &lt;code&gt;services.nginx.enable = true;&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;This setting influences the lower-level option &lt;code&gt;systemd.services.nginx&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Which, in turn, affects the even lower-level option
&lt;code&gt;systemd.units.&quot;nginx.service&quot;&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Ultimately, this leads to the creation of a systemd unit file within
&lt;code&gt;environment.etc.&quot;systemd&#x2F;system&quot;&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Finally, this unit file ends up as &lt;code&gt;result&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;nginx.service&lt;&#x2F;code&gt;
within the final &lt;code&gt;system.build.toplevel&lt;&#x2F;code&gt; derivation.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;strong&gt;Key Takeaway:&lt;&#x2F;strong&gt; Higher-level, user-friendly options are translated into
lower-level system configurations that are part of the final system build.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-nixos-module-system-evaluating-options&quot;&gt;The NixOS Module System: Evaluating Options&lt;&#x2F;h2&gt;
&lt;p&gt;So, how do these options get processed and turned into the final system
configuration? That&#x27;s the job of the &lt;strong&gt;NixOS module system&lt;&#x2F;strong&gt;, located in the
&lt;code&gt;.&#x2F;lib&lt;&#x2F;code&gt; directory of Nixpkgs (specifically in &lt;code&gt;modules.nix&lt;&#x2F;code&gt;, &lt;code&gt;options.nix&lt;&#x2F;code&gt;,
and &lt;code&gt;types.nix&lt;&#x2F;code&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;Interestingly, the module system isn&#x27;t exclusive to NixOS; you can use it to
manage option sets in your own Nix projects.&lt;&#x2F;p&gt;
&lt;p&gt;Here&#x27;s a simplified example of using the module system outside of NixOS:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;nix&quot; style=&quot;background-color:#212733;color:#ccc9c2;&quot; class=&quot;language-nix &quot;&gt;&lt;code class=&quot;language-nix&quot; data-lang=&quot;nix&quot;&gt;&lt;span style=&quot;color:#ffa759;&quot;&gt;let
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;systemModule &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;lib&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;config&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;, ... &lt;&#x2F;span&gt;&lt;span&gt;}: {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;options&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;toplevel &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;lib&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;mkOption &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;lib&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;types&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;str&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    }&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;options&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;enableFoo &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;lib&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;mkOption &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;lib&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;types&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;bool&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;default &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;false&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    }&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;config&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;toplevel &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bae67e;&quot;&gt;&amp;#39;&amp;#39;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bae67e;&quot;&gt;      Is foo enabled? &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ccc9c2;&quot;&gt;${&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ffcc66;&quot;&gt;lib&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ffcc66;&quot;&gt;boolToString config&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ffcc66;&quot;&gt;enableFoo&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#ccc9c2;&quot;&gt;}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bae67e;&quot;&gt;    &amp;#39;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  }&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;userModule &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;enableFoo &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  }&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffa759;&quot;&gt;in &lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f28779;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bae67e;&quot;&gt;&amp;lt;nixpkgs&#x2F;lib&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt;)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;evalModules &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;modules &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;[ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;systemModule userModule &lt;&#x2F;span&gt;&lt;span&gt;]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;You can evaluate the &lt;code&gt;config.toplevel&lt;&#x2F;code&gt; option from this example using:&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#212733;color:#ccc9c2;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;nix-instantiate&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt; --eval&lt;&#x2F;span&gt;&lt;span&gt; file.nix&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt; -A&lt;&#x2F;span&gt;&lt;span&gt; config.toplevel
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;Key Takeaway&lt;&#x2F;strong&gt;: The NixOS module system is responsible for evaluating and
merging option configurations from different modules.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;how-the-module-system-works-a-simplified-overview&quot;&gt;How the Module System Works: A Simplified Overview&lt;&#x2F;h2&gt;
&lt;p&gt;The module system processes a set of &quot;modules&quot; through these general steps:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Importing Modules&lt;&#x2F;strong&gt;: It recursively finds and includes all modules
specified in &lt;code&gt;imports = [ ... ];&lt;&#x2F;code&gt; statements.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Declaring Options&lt;&#x2F;strong&gt;: It collects all option declarations defined using
&lt;code&gt;options = { ... };&lt;&#x2F;code&gt; from all the modules and merges them. If the same option
is declared in multiple modules, the module system handles this
(details omitted for simplicity).&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Defining Option Values&lt;&#x2F;strong&gt;: For each declared option, it gathers all the
value assignments (defined using &lt;code&gt;config = { ... };&lt;&#x2F;code&gt; or directly at the top
level if no &lt;code&gt;options&lt;&#x2F;code&gt; or &lt;code&gt;config&lt;&#x2F;code&gt; are present) from all modules and merges
them according to the option&#x27;s defined type.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Important Note&lt;&#x2F;strong&gt;: Option evaluation is lazy, meaning an option&#x27;s value is
only computed when it&#x27;s actually needed. It can also depend on the values of
other options.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Key Takeaway&lt;&#x2F;strong&gt;: The module system imports, declares, and then evaluates
option values from various modules to build the final configuration.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Top-Level Attributes in a Module: &lt;code&gt;imports&lt;&#x2F;code&gt;, &lt;code&gt;options&lt;&#x2F;code&gt;, and &lt;code&gt;config&lt;&#x2F;code&gt;&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Within a NixOS module (the files that define parts of your system configuration)
, the attributes defined directly at the top level of the module&#x27;s function
have specific meanings:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;imports&lt;&#x2F;code&gt;: This attribute is a list of other module files to include. Their
options and configurations will also be part of the evaluation.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;options&lt;&#x2F;code&gt;: This attribute is where you declare new configuration options. You
define their type, default value, description, etc., using functions like
&lt;code&gt;lib.mkOption&lt;&#x2F;code&gt; or &lt;code&gt;lib.mkEnableOption&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;config&lt;&#x2F;code&gt;: This attribute is where you assign values to the options that have
been declared (either in the current module or in imported modules).&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;strong&gt;Key Takeaway&lt;&#x2F;strong&gt;: The top-level attributes &lt;code&gt;imports&lt;&#x2F;code&gt;, &lt;code&gt;options&lt;&#x2F;code&gt;, and &lt;code&gt;config&lt;&#x2F;code&gt;
are the primary ways to structure a NixOS module.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;The Rule: Move Non-Option Attributes Under &lt;code&gt;config&lt;&#x2F;code&gt;&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;If you define either an &lt;code&gt;options&lt;&#x2F;code&gt; or a &lt;code&gt;config&lt;&#x2F;code&gt; attribute at the top level of
your module, any other attributes that are not option declarations must be
moved inside the config attribute.&lt;&#x2F;p&gt;
&lt;p&gt;Let&#x27;s look at an example of what not to do:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;nix&quot; style=&quot;background-color:#212733;color:#ccc9c2;&quot; class=&quot;language-nix &quot;&gt;&lt;code class=&quot;language-nix&quot; data-lang=&quot;nix&quot;&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;pkgs&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;lib&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;config&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;, ... &lt;&#x2F;span&gt;&lt;span&gt;}:
&lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;imports &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;[]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#5c6773;&quot;&gt;# Defining an option at the top level
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;options&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;mine&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;desktop&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;enable &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;lib&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;mkEnableOption &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bae67e;&quot;&gt;&amp;quot;desktop settings&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#5c6773;&quot;&gt;# This will cause an error because &amp;#39;environment&amp;#39; and &amp;#39;appstream&amp;#39;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#5c6773;&quot;&gt;# are not &amp;#39;options&amp;#39; and &amp;#39;config&amp;#39; is also present at the top level.
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;environment&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;systemPackages &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;=
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;lib&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;mkIf config&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;appstream&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;enable &lt;&#x2F;span&gt;&lt;span&gt;[ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;pkgs&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;git &lt;&#x2F;span&gt;&lt;span&gt;]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;appstream&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;enable &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This will result in the error: &lt;code&gt;error: Module has an unsupported attribute &#x27;appstream&#x27; This is caused by introducing a top-level &#x27;config&#x27; or &#x27;options&#x27; attribute. Add configuration attributes immediately on the top level instead, or move all of them into the explicit &#x27;config&#x27; attribute&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Key Takeaway&lt;&#x2F;strong&gt;: When you have &lt;code&gt;options&lt;&#x2F;code&gt; or &lt;code&gt;config&lt;&#x2F;code&gt; at the top level, all
value assignments need to go inside the config block.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;The Correct Way&lt;&#x2F;strong&gt;): Using the &lt;code&gt;config&lt;&#x2F;code&gt; Attribute&lt;&#x2F;p&gt;
&lt;p&gt;To fix the previous example, you need to move the value assignments for
&lt;code&gt;environment.systemPackages&lt;&#x2F;code&gt; and &lt;code&gt;appstream.enable&lt;&#x2F;code&gt; inside the config attribute:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;nix&quot; style=&quot;background-color:#212733;color:#ccc9c2;&quot; class=&quot;language-nix &quot;&gt;&lt;code class=&quot;language-nix&quot; data-lang=&quot;nix&quot;&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;pkgs&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;lib&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;config&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;, ... &lt;&#x2F;span&gt;&lt;span&gt;}:
&lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;imports &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;[]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#5c6773;&quot;&gt;# Defining an option at the top level
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;options&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;mine&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;desktop&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;enable &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;lib&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;mkEnableOption &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bae67e;&quot;&gt;&amp;quot;desktop settings&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;config &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;environment&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;systemPackages &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;=
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;lib&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;mkIf config&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;appstream&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;enable &lt;&#x2F;span&gt;&lt;span&gt;[ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;pkgs&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;git &lt;&#x2F;span&gt;&lt;span&gt;]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;appstream&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;enable &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Now, Nix knows that you are declaring an option (&lt;code&gt;options.mine.desktop.enable&lt;&#x2F;code&gt;)
and then setting values for other options (&lt;code&gt;environment.systemPackages&lt;&#x2F;code&gt;,
&lt;code&gt;appstream.enable&lt;&#x2F;code&gt;) within the &lt;code&gt;config&lt;&#x2F;code&gt; block.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Key Takeaway&lt;&#x2F;strong&gt;: The &lt;code&gt;config&lt;&#x2F;code&gt; attribute is used to define the values of
options.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Implicit &lt;code&gt;config&lt;&#x2F;code&gt;: When &lt;code&gt;options&lt;&#x2F;code&gt; is Absent&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;If your module does not define either &lt;code&gt;options&lt;&#x2F;code&gt; or &lt;code&gt;config&lt;&#x2F;code&gt; at the top level,
then any attributes you define directly at the top level are implicitly
treated as being part of the config.&lt;&#x2F;p&gt;
&lt;p&gt;For example, this is valid:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;nix&quot; style=&quot;background-color:#212733;color:#ccc9c2;&quot; class=&quot;language-nix &quot;&gt;&lt;code class=&quot;language-nix&quot; data-lang=&quot;nix&quot;&gt;&lt;span&gt;{ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;pkgs&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;lib&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;config&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;, ... &lt;&#x2F;span&gt;&lt;span&gt;}:
&lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;environment&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;systemPackages &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;=
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;lib&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;mkIf config&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;appstream&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;enable &lt;&#x2F;span&gt;&lt;span&gt;[ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;pkgs&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;git &lt;&#x2F;span&gt;&lt;span&gt;]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;appstream&lt;&#x2F;span&gt;&lt;span&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffd580;&quot;&gt;enable &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29e74;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ffcc66;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ccc9c2cc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Nix will implicitly understand that &lt;code&gt;environment.systemPackages&lt;&#x2F;code&gt; and
&lt;code&gt;appstream.enable&lt;&#x2F;code&gt; are configuration settings.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Key Takeaway&lt;&#x2F;strong&gt;: If no explicit options or config are present, top-level
attributes are automatically considered part of the configuration.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Removing an Option: What Happens to &lt;code&gt;config&lt;&#x2F;code&gt;&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Even if you remove the &lt;code&gt;options&lt;&#x2F;code&gt; declaration from a module that has a &lt;code&gt;config&lt;&#x2F;code&gt;
section, the &lt;code&gt;config = { environment.systemPackages = ... };&lt;&#x2F;code&gt; part will still
function correctly, assuming the option it&#x27;s referencing (&lt;code&gt;appstream.enable&lt;&#x2F;code&gt;
in this case) is defined elsewhere (e.g., in an imported module).&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Key Takeaway&lt;&#x2F;strong&gt;: The &lt;code&gt;config&lt;&#x2F;code&gt; section defines values for options, regardless
of whether those options are declared in the same module.&lt;&#x2F;p&gt;


    </div>

    <script defer src="https://saylesss88.github.io/elasticlunr.min.js"></script>
    <script defer>
      let index;

      fetch(`${baseUrl}/search_index.en.json`)
        .then((response) => response.json())
        .then((data) => {
          index = elasticlunr.Index.load(data);

          const searchInput = document.getElementById("search");
          const resultsContainer = document.querySelector(".search-results");
          const resultsList = document.querySelector(".search-results__items");

          searchInput.addEventListener("input", (e) => {
            const query = e.target.value.trim();

            if (!query || !index) {
              resultsContainer.style.display = "none";
              resultsList.innerHTML = "";
              return;
            }

            const results = index.search(query, { expand: true });

            if (results.length > 0) {
              resultsList.innerHTML = results
                .map((result) => {
                  const ref = index.documentStore.getDoc(result.ref);
                  return `<li><a href="${ref.permalink}">${ref.title}</a></li>`;
                })
                .join("");
              resultsContainer.style.display = "block";
            } else {
              resultsList.innerHTML = "<li>No results found.</li>";
              resultsContainer.style.display = "block";
            }
          });
        })
        .catch((err) => {
          console.error("Search index failed to load:", err);
        });
    </script>

    <script defer>
      document.addEventListener("DOMContentLoaded", () => {
        const darkModeToggle = document.getElementById("dark-mode-toggle");
        const body = document.body;

        const savedTheme = localStorage.getItem("theme") || "light";

        // Apply the saved theme on load
        if (savedTheme === "dark") {
          body.classList.add("dark-mode");
        }

        darkModeToggle.addEventListener("click", () => {
          body.classList.toggle("dark-mode");
          const currentTheme = body.classList.contains("dark-mode")
            ? "dark"
            : "light";
          localStorage.setItem("theme", currentTheme);
        });
      });
    </script>
  </body>
</html>
