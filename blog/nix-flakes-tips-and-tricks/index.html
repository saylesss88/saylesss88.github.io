<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>My-Nix-Blog</title>
    <style>
      body {
        background-color: #282828; /* Dark background */
        color: #ebdbb2; /* Light text for readability */
      }
      ul li {
        margin-bottom: 0.75em; /* Add space below each link item */
      }
    </style>
  </head>

  <body>
    <section class="section">
      <div class="container">
<h1 class="title">Nix Flakes Tips and Tricks</h1>
<p class="subtitle"><strong>2025-05-06</strong></p>
<h3 id="nix-flake-tips-and-tricks">Nix Flake Tips and Tricks</h3>
<ol>
<li>Shallow clone nixpkgs, the full Git history isn't always necessary and this can speed up build times.</li>
</ol>
<ul>
<li>The only issue I've had is <code>nix-index-database</code> not working well with the shallow clone... Other than that no issues after running for a few months.</li>
</ul>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="font-style:italic;color:#928374;"># flake.nix
</span><span style="color:#fdf4c1;">inputs </span><span style="background-color:#932b1e;color:#fdf4c1;">=</span><span> {
</span><span>    </span><span style="color:#8ec07c;">nixpkgs</span><span>.</span><span style="color:#8ec07c;">url </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;git+https://github.com/NixOS/nixpkgs?shallow=1&amp;ref=nixos-unstable&quot;</span><span>;
</span><span>}</span><span style="background-color:#932b1e;color:#fdf4c1;">;</span><span>
</span></code></pre>
<ul>
<li>Some times when you might need a full clone are debugging and working with repository history
but those are rare.</li>
</ul>
<ol start="2">
<li>Importing your non-flake wallpapers repo:</li>
</ol>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="font-style:italic;color:#928374;"># flake.nix
</span><span style="color:#fdf4c1;">inputs </span><span style="background-color:#932b1e;color:#fdf4c1;">=</span><span> {
</span><span>    </span><span style="color:#8ec07c;">wallpapers </span><span style="color:#fe8019;">= </span><span>{
</span><span>      </span><span style="color:#8ec07c;">url </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;git+ssh://git@github.com/TSawyer87/wallpapers.git&quot;</span><span>;
</span><span>      </span><span style="color:#8ec07c;">flake </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">false</span><span>;
</span><span>    };
</span><span>}
</span></code></pre>
<ul>
<li>After adding the input I can access individual wallpapers by adding the <code>inputs</code> argument and
something like <code>path = "${inputs.wallpapers}/Aesthetic Scenery.jpg";</code></li>
</ul>
<ol start="3">
<li>Understanding <code>@-patterns</code>, being able to reference your outputs argument set as a whole. An
<code>@-pattern</code> is a way for a function can access variadic attributes (i.e. varying number of
arguments).</li>
</ol>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="font-style:italic;color:#928374;"># flake.nix
</span><span style="color:#fdf4c1;">inputs </span><span style="background-color:#932b1e;color:#fdf4c1;">=</span><span> {
</span><span>    </span><span style="color:#8ec07c;">home-manager</span><span>.</span><span style="color:#8ec07c;">url </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;github:nix-community/home-manager/master&quot;</span><span>;
</span><span>    </span><span style="color:#8ec07c;">home-manager</span><span>.</span><span style="color:#8ec07c;">inputs</span><span>.</span><span style="color:#8ec07c;">nixpkgs</span><span>.</span><span style="color:#8ec07c;">follows </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;nixpkgs&quot;</span><span>;
</span><span>    </span><span style="color:#8ec07c;">stylix</span><span>.</span><span style="color:#8ec07c;">url </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;github:danth/stylix&quot;</span><span>;
</span><span>}</span><span style="background-color:#932b1e;color:#fdf4c1;">;</span><span>
</span><span style="color:#fdf4c1;">outputs </span><span style="background-color:#932b1e;color:#fdf4c1;">=</span><span> {
</span><span>    </span><span style="color:#fdf4c1;">self</span><span style="color:#fe8019;">,
</span><span>    </span><span style="color:#fdf4c1;">nixpkgs</span><span style="color:#fe8019;">,
</span><span>    </span><span style="color:#fdf4c1;">home-manager</span><span style="color:#fe8019;">,
</span><span style="color:#d3869b;">}</span><span> @ </span><span style="color:#fdf4c1;">inputs</span><span>:
</span></code></pre>
<p>With the above example to add the modules to your nixosConfigurations you would add something
like this:</p>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="font-style:italic;color:#928374;"># flake.nix
</span><span style="color:#fdf4c1;">nixosConfigurations</span><span style="color:#fe8019;">.</span><span style="font-style:italic;color:#fdf4c1aa;">${</span><span style="color:#fdf4c1;">host</span><span style="font-style:italic;color:#fdf4c1aa;">} </span><span style="background-color:#932b1e;color:#fdf4c1;">=</span><span> </span><span style="color:#fdf4c1;">nixpkgs</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">lib</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">nixosSystem </span><span>{
</span><span>  </span><span style="color:#fa5c4b;">inherit </span><span style="color:#8ec07c;">system</span><span>;
</span><span>  </span><span style="color:#8ec07c;">specialArgs </span><span style="color:#fe8019;">= </span><span>{
</span><span>    </span><span style="color:#fa5c4b;">inherit </span><span style="color:#8ec07c;">inputs username host email systemSettings</span><span>;
</span><span>};
</span><span style="color:#8ec07c;">modules </span><span style="color:#fe8019;">= </span><span>[
</span><span>  </span><span style="color:#b8bb26;">./hosts</span><span style="color:#fe8019;">/</span><span style="font-style:italic;color:#fdf4c1aa;">${</span><span style="color:#fdf4c1;">host</span><span style="font-style:italic;color:#fdf4c1aa;">}</span><span style="color:#b8bb26;">/config.nix
</span><span>  </span><span style="color:#fdf4c1;">inputs</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">stylix</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">nixosModules</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">stylix
</span><span>  </span><span style="color:#fdf4c1;">home-manager</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">nixosModules</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">home-manager
</span><span>  </span><span style="font-style:italic;color:#928374;"># .. snip ..
</span><span>];
</span></code></pre>
<ul>
<li>Notice that since home-manager was explicitly listed in the outputs arguments:
<code>outputs = { self, nixpkgs, home-manager, }; </code> the <code>inputs</code> prefix is unnecessary.
If home-manager was removed from the outputs arguments: <code>outputs = { self, ... }</code>
then you would need <code>modules = [ inputs.home-manager.nixosModules.home-manager];</code> This can be confusing
because many docs assume your not using an @-pattern so if you have one in your flake you need to prefix
with <code>inputs</code>. I use this to reference my personal wallpapers repo mentioned earlier.</li>
</ul>
<ol start="4">
<li>Understanding <code>specialArgs</code> (nixos) and <code>extraSpecialArgs</code> (home-manager). Building on the @-patterns, using
<code>specialArgs</code> and <code>extraSpecialArgs</code> is a way to pass arguments from your flake to your NixOS and home-manager
modules.</li>
</ol>
<p>For example, here is a snippet of some variables I set:</p>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="font-style:italic;color:#928374;"># flake.nix
</span><span style="color:#fdf4c1;">outputs </span><span style="background-color:#932b1e;color:#fdf4c1;">=</span><span> {
</span><span>  </span><span style="color:#fdf4c1;">self</span><span style="color:#fe8019;">,
</span><span>  </span><span style="color:#fdf4c1;">nixpkgs</span><span style="color:#fe8019;">,
</span><span>  </span><span style="color:#fdf4c1;">home-manager</span><span style="color:#fe8019;">,
</span><span>  </span><span style="color:#fe8019;">...
</span><span style="color:#d3869b;">}</span><span> @ </span><span style="color:#fdf4c1;">inputs</span><span>: </span><span style="color:#fa5c4b;">let
</span><span>  </span><span style="color:#8ec07c;">system </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;x86_64-linux&quot;</span><span>;
</span><span>  </span><span style="color:#8ec07c;">host </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;magic&quot;</span><span>;
</span><span>  </span><span style="color:#8ec07c;">username </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;jr&quot;</span><span>;
</span><span>  </span><span style="color:#8ec07c;">userVars </span><span style="color:#fe8019;">= </span><span>{
</span><span>    </span><span style="color:#8ec07c;">timezone </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;America/New_York&quot;</span><span>;
</span><span>    </span><span style="color:#8ec07c;">locale </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;en_US.UTF-8&quot;</span><span>;
</span><span>    </span><span style="color:#8ec07c;">gitUsername </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;TSawyer87&quot;</span><span>;
</span><span>    </span><span style="color:#8ec07c;">dotfilesDir </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;~/.dotfiles&quot;</span><span>;
</span><span>    </span><span style="color:#8ec07c;">wm </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;hyprland&quot;</span><span>;
</span><span>    </span><span style="color:#8ec07c;">browser </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;firefox&quot;</span><span>;
</span><span>    </span><span style="color:#8ec07c;">term </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;ghostty&quot;</span><span>;
</span><span>    </span><span style="color:#8ec07c;">editor </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;hx&quot;</span><span>;
</span><span>    </span><span style="color:#8ec07c;">keyboardLayout </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;us&quot;</span><span>;
</span><span>  };
</span><span>  </span><span style="color:#fa5c4b;">in
</span></code></pre>
<p>Now I can pass them as special args like this:</p>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="font-style:italic;color:#928374;"># flake.nix
</span><span style="color:#fdf4c1;">nixosConfigurations </span><span style="background-color:#932b1e;color:#fdf4c1;">=</span><span> {
</span><span>      </span><span style="font-style:italic;color:#fdf4c1aa;">${</span><span style="color:#fdf4c1;">host</span><span style="font-style:italic;color:#fdf4c1aa;">} </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">nixpkgs</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">lib</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">nixosSystem </span><span>{
</span><span>        </span><span style="color:#fa5c4b;">inherit </span><span style="color:#8ec07c;">system</span><span>;
</span><span>        </span><span style="color:#8ec07c;">specialArgs </span><span style="color:#fe8019;">= </span><span>{
</span><span>          </span><span style="color:#fa5c4b;">inherit
</span><span>            </span><span style="color:#8ec07c;">inputs
</span><span>            </span><span style="color:#8ec07c;">username
</span><span>            </span><span style="color:#8ec07c;">system
</span><span>            </span><span style="color:#8ec07c;">host
</span><span>            </span><span style="color:#8ec07c;">userVars
</span><span>            ;
</span><span>        };
</span><span>        </span><span style="color:#8ec07c;">modules </span><span style="color:#fe8019;">= </span><span>[
</span><span>        </span><span style="color:#b8bb26;">./hosts</span><span style="color:#fe8019;">/</span><span style="font-style:italic;color:#fdf4c1aa;">${</span><span style="color:#fdf4c1;">host</span><span style="font-style:italic;color:#fdf4c1aa;">}</span><span style="color:#b8bb26;">/configuration.nix
</span><span>        </span><span style="color:#fdf4c1;">home-manager</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">nixosModules</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">home-manager
</span><span>        </span><span style="color:#fdf4c1;">inputs</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">stylix</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">nixosModules</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">stylix
</span><span>        {
</span><span>          </span><span style="color:#8ec07c;">home-manager</span><span>.</span><span style="color:#8ec07c;">useGlobalPkgs </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">true</span><span>;
</span><span>          </span><span style="color:#8ec07c;">home-manager</span><span>.</span><span style="color:#8ec07c;">useUserPackages </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">true</span><span>;
</span><span>          </span><span style="color:#8ec07c;">home-manager</span><span>.</span><span style="color:#8ec07c;">users</span><span>.</span><span style="font-style:italic;color:#fdf4c1aa;">${</span><span style="color:#fdf4c1;">username</span><span style="font-style:italic;color:#fdf4c1aa;">} </span><span style="color:#fe8019;">= </span><span style="color:#fabd2f;">import </span><span style="color:#b8bb26;">./hosts</span><span style="color:#fe8019;">/</span><span style="font-style:italic;color:#fdf4c1aa;">${</span><span style="color:#fdf4c1;">host</span><span style="font-style:italic;color:#fdf4c1aa;">}</span><span style="color:#b8bb26;">/home.nix</span><span>;
</span><span>          </span><span style="color:#8ec07c;">home-manager</span><span>.</span><span style="color:#8ec07c;">backupFileExtension </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;backup&quot;</span><span>;
</span><span>          </span><span style="color:#8ec07c;">home-manager</span><span>.</span><span style="color:#8ec07c;">extraSpecialArgs </span><span style="color:#fe8019;">= </span><span>{
</span><span>            </span><span style="color:#fa5c4b;">inherit
</span><span>              </span><span style="color:#8ec07c;">inputs
</span><span>              </span><span style="color:#8ec07c;">username
</span><span>              </span><span style="color:#8ec07c;">system
</span><span>              </span><span style="color:#8ec07c;">host
</span><span>              </span><span style="color:#8ec07c;">userVars
</span><span>              ;
</span><span>          };
</span><span>        }
</span><span>      ];
</span></code></pre>
<ul>
<li>To access values in <code>userVars</code> for example:</li>
</ul>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="font-style:italic;color:#928374;"># git.nix
</span><span style="color:#d3869b;">{ </span><span style="color:#fdf4c1;">userVars</span><span style="color:#fe8019;">, ... </span><span style="color:#d3869b;">}</span><span>: {
</span><span>  </span><span style="color:#8ec07c;">programs </span><span style="color:#fe8019;">= </span><span>{
</span><span>    </span><span style="color:#8ec07c;">git </span><span style="color:#fe8019;">= </span><span>{
</span><span>      </span><span style="color:#8ec07c;">enable </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">true</span><span>;
</span><span>      </span><span style="color:#8ec07c;">userName </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">userVars</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">gitUsername</span><span>;
</span><span>    };
</span><span>  };
</span><span>}
</span></code></pre>
<ol start="5">
<li>Set up <code>checks</code> and <code>formatter</code> outputs with <code>treefmt-nix</code>. Add <code>treefmt-nix</code> to your inputs and outputs arguments.
Inside the <code>let</code> expression from tip 4 I would add:</li>
</ol>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="font-style:italic;color:#928374;"># flake.nix
</span><span style="color:#fa5c4b;">let
</span><span style="font-style:italic;color:#928374;"># ... snip ...
</span><span style="color:#8ec07c;">pkgs </span><span style="color:#fe8019;">= </span><span style="color:#fabd2f;">import </span><span style="color:#fdf4c1;">nixpkgs </span><span>{
</span><span>  </span><span style="color:#fa5c4b;">inherit </span><span style="color:#8ec07c;">system</span><span>;
</span><span>  </span><span style="color:#8ec07c;">config</span><span>.</span><span style="color:#8ec07c;">allowUnfree </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">true</span><span>;
</span><span>};
</span><span style="color:#8ec07c;">treefmtEval </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">treefmt-nix</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">lib</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">evalModule pkgs </span><span style="color:#b8bb26;">./treefmt.nix</span><span>;
</span><span style="color:#fa5c4b;">in
</span><span>{
</span><span>  </span><span style="color:#8ec07c;">checks</span><span>.</span><span style="color:#8ec07c;">x86_64-linux</span><span>.</span><span style="color:#8ec07c;">style </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">treefmtEval</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">config</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">build</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">check self</span><span>;
</span><span>
</span><span>  </span><span style="color:#8ec07c;">formatter</span><span>.</span><span style="color:#8ec07c;">x86_64-linux </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">treefmtEval</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">config</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">build</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">wrapper</span><span>;
</span><span>
</span><span>  </span><span style="font-style:italic;color:#928374;"># ... snip ...
</span><span>}
</span></code></pre>
<p>And in the <code>treefmt.nix</code>:</p>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="font-style:italic;color:#928374;"># treefmt.nix
</span><span>{
</span><span style="color:#8ec07c;">projectRootFile </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;flake.nix&quot;</span><span>;
</span><span style="color:#8ec07c;">programs </span><span style="color:#fe8019;">= </span><span>{
</span><span>  </span><span style="color:#8ec07c;">deadnix</span><span>.</span><span style="color:#8ec07c;">enable </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">true</span><span>;
</span><span>  </span><span style="color:#8ec07c;">statix</span><span>.</span><span style="color:#8ec07c;">enable </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">true</span><span>;
</span><span>  </span><span style="color:#8ec07c;">keep-sorted</span><span>.</span><span style="color:#8ec07c;">enable </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">true</span><span>;
</span><span>  </span><span style="color:#8ec07c;">nixfmt </span><span style="color:#fe8019;">= </span><span>{
</span><span>    </span><span style="color:#8ec07c;">enable </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">true</span><span>;
</span><span>    </span><span style="color:#8ec07c;">strict </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">true</span><span>;
</span><span>  };
</span><span>};
</span><span style="color:#8ec07c;">settings</span><span>.</span><span style="color:#8ec07c;">excludes </span><span style="color:#fe8019;">= </span><span>[
</span><span>  </span><span style="color:#b8bb26;">&quot;*.age&quot;
</span><span>  </span><span style="color:#b8bb26;">&quot;*.jpg&quot;
</span><span>  </span><span style="color:#b8bb26;">&quot;*.nu&quot;
</span><span>  </span><span style="color:#b8bb26;">&quot;*.png&quot;
</span><span>  </span><span style="color:#b8bb26;">&quot;.jj/*&quot;
</span><span>  </span><span style="color:#b8bb26;">&quot;flake.lock&quot;
</span><span>  </span><span style="color:#b8bb26;">&quot;justfile&quot;
</span><span>];
</span><span style="color:#8ec07c;">settings</span><span>.</span><span style="color:#8ec07c;">formatter </span><span style="color:#fe8019;">= </span><span>{
</span><span>  </span><span style="color:#8ec07c;">deadnix </span><span style="color:#fe8019;">= </span><span>{
</span><span>    </span><span style="color:#8ec07c;">priority </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">1</span><span>;
</span><span>  };
</span><span>
</span><span>  </span><span style="color:#8ec07c;">statix </span><span style="color:#fe8019;">= </span><span>{
</span><span>    </span><span style="color:#8ec07c;">priority </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">2</span><span>;
</span><span>  };
</span><span>
</span><span>  </span><span style="color:#8ec07c;">nixfmt </span><span style="color:#fe8019;">= </span><span>{
</span><span>    </span><span style="color:#8ec07c;">priority </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">3</span><span>;
</span><span>  };
</span><span>};
</span><span>}
</span></code></pre>
<ul>
<li>
<p>Use <code>treefmt-nix</code> to manage code formatters and linters as flake outputs. This ensures consistent styling
and catches issues with tools like <code>deadnix</code>, <code>statix</code>, and <code>nixfmt</code>.</p>
</li>
<li>
<p>Use <code>nix fmt</code> in the flake directory to format your whole configuration.</p>
</li>
<li>
<p>Now you can run <code>nix flake check</code> to run your checks. Running <code>nix flake show</code> will list your outputs.</p>
</li>
<li>
<p>Tools like <code>nix-fast-build</code> rely on flake checks and can be used after setting this up.</p>
</li>
</ul>
<ol start="6">
<li>Make a devShell output:</li>
</ol>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span> </span><span style="background-color:#932b1e;color:#fdf4c1;">in</span><span>
</span><span>    {
</span><span>      </span><span style="color:#8ec07c;">checks</span><span>.</span><span style="color:#8ec07c;">x86_64-linux</span><span>.</span><span style="color:#8ec07c;">style </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">treefmtEval</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">config</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">build</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">check self</span><span>;
</span><span>
</span><span>      </span><span style="color:#8ec07c;">formatter</span><span>.</span><span style="color:#8ec07c;">x86_64-linux </span><span style="color:#fe8019;">= </span><span style="color:#fdf4c1;">treefmtEval</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">config</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">build</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">wrapper</span><span>;
</span><span>
</span><span>      </span><span style="color:#8ec07c;">devShells</span><span>.</span><span style="font-style:italic;color:#fdf4c1aa;">${</span><span style="color:#fdf4c1;">system</span><span style="font-style:italic;color:#fdf4c1aa;">}</span><span>.</span><span style="color:#8ec07c;">default </span><span style="color:#fe8019;">= </span><span style="color:#fabd2f;">import </span><span style="color:#b8bb26;">./lib/dev-shell.nix </span><span>{ </span><span style="color:#fa5c4b;">inherit </span><span style="color:#8ec07c;">inputs</span><span>; };
</span></code></pre>
<p>and in the <code>dev-shell.nix</code> you could put something like this:</p>
<pre data-lang="nix" style="background-color:#282828;color:#fdf4c1aa;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="font-style:italic;color:#928374;"># dev-shell.nix
</span><span>{
</span><span>  </span><span style="color:#fdf4c1;">inputs</span><span style="color:#fe8019;">,
</span><span>  </span><span style="color:#fdf4c1;">system </span><span style="color:#fe8019;">? </span><span style="color:#b8bb26;">&quot;x86_64-linux&quot;</span><span style="color:#fe8019;">,
</span><span style="color:#d3869b;">}</span><span>:
</span><span style="color:#fa5c4b;">let
</span><span>  </span><span style="font-style:italic;color:#928374;"># Instantiate nixpkgs with the given system and allow unfree packages
</span><span>  </span><span style="color:#8ec07c;">pkgs </span><span style="color:#fe8019;">= </span><span style="color:#fabd2f;">import </span><span style="color:#fdf4c1;">inputs</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">nixpkgs </span><span>{
</span><span>    </span><span style="color:#fa5c4b;">inherit </span><span style="color:#8ec07c;">system</span><span>;
</span><span>    </span><span style="color:#8ec07c;">config</span><span>.</span><span style="color:#8ec07c;">allowUnfree </span><span style="color:#fe8019;">= </span><span style="color:#d3869b;">true</span><span>;
</span><span>    </span><span style="color:#8ec07c;">overlays </span><span style="color:#fe8019;">= </span><span>[
</span><span>      </span><span style="font-style:italic;color:#928374;"># Add overlays if needed, e.g., inputs.neovim-nightly-overlay.overlays.default
</span><span>    ];
</span><span>  };
</span><span style="color:#fa5c4b;">in
</span><span style="color:#fdf4c1;">pkgs</span><span style="color:#fe8019;">.</span><span style="color:#fdf4c1;">mkShell </span><span>{
</span><span>  </span><span style="color:#8ec07c;">name </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&quot;nixos-dev&quot;</span><span>;
</span><span>  </span><span style="color:#8ec07c;">packages </span><span style="color:#fe8019;">= </span><span style="color:#fa5c4b;">with </span><span style="color:#fdf4c1;">pkgs</span><span>; [
</span><span>    </span><span style="font-style:italic;color:#928374;"># Nix tools
</span><span>    </span><span style="color:#fdf4c1;">nixfmt-rfc-style </span><span style="font-style:italic;color:#928374;"># Formatter
</span><span>    </span><span style="color:#fdf4c1;">deadnix </span><span style="font-style:italic;color:#928374;"># Dead code detection
</span><span>    </span><span style="color:#fdf4c1;">nixd </span><span style="font-style:italic;color:#928374;"># Nix language server
</span><span>    </span><span style="color:#fdf4c1;">nil </span><span style="font-style:italic;color:#928374;"># Alternative Nix language server
</span><span>    </span><span style="color:#fdf4c1;">nh </span><span style="font-style:italic;color:#928374;"># Nix helper
</span><span>    </span><span style="color:#fdf4c1;">nix-diff </span><span style="font-style:italic;color:#928374;"># Compare Nix derivations
</span><span>    </span><span style="color:#fdf4c1;">nix-tree </span><span style="font-style:italic;color:#928374;"># Visualize Nix dependencies
</span><span>
</span><span>    </span><span style="font-style:italic;color:#928374;"># Code editing
</span><span>    </span><span style="color:#fdf4c1;">helix
</span><span>
</span><span>    </span><span style="font-style:italic;color:#928374;"># General utilities
</span><span>    </span><span style="color:#fdf4c1;">git
</span><span>    </span><span style="color:#fdf4c1;">ripgrep
</span><span>    </span><span style="color:#fdf4c1;">jq
</span><span>    </span><span style="color:#fdf4c1;">tree
</span><span>  ];
</span><span>
</span><span>  </span><span style="color:#8ec07c;">shellHook </span><span style="color:#fe8019;">= </span><span style="color:#b8bb26;">&#39;&#39;
</span><span style="color:#b8bb26;">    echo &quot;Welcome to the NixOS development shell!&quot;
</span><span style="color:#b8bb26;">    echo &quot;System: </span><span style="font-style:italic;color:#b8bb26;">${</span><span style="color:#fdf4c1;">system</span><span style="font-style:italic;color:#b8bb26;">}</span><span style="color:#b8bb26;">&quot;
</span><span style="color:#b8bb26;">    echo &quot;Tools available: nixfmt, deadnix, nixd, nil, nh, nix-diff, nix-tree, helix, git, ripgrep, jq, tree&quot;
</span><span style="color:#b8bb26;">  &#39;&#39;</span><span>;
</span><span>}
</span></code></pre>
<ul>
<li>You can enter this devshell with <code>nix develop</code> or automatically with <code>direnv</code>.</li>
</ul>
 </div>
    </section>
  </body>
</html>
