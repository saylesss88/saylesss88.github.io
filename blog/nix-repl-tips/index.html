<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>My-Nix-Blog</title>
    <style>
      body {
        background-color: #1e2a38; /* Dark background */
        color: #ffffff; /* Light text for readability */
      }
    </style>
  </head>

  <body>
    <section class="section">
      <div class="container">
<h1 class="title">Nix Repl</h1>
<p class="subtitle"><strong>2025-05-06</strong></p>
<h1 id="nix-repl">Nix Repl</h1>
<p>List available commands with <code>:?</code>:</p>
<pre data-lang="nix" style="background-color:#0f1419;color:#bfbab0;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#f29718;">nix repl
</span><span style="color:#f29718;">Nix 2</span><span style="color:#f29668;">.</span><span style="color:#f29718;">24</span><span style="color:#f29668;">.</span><span style="color:#f29718;">11
</span><span style="color:#f29718;">Type </span><span>:</span><span style="color:#ff3333;">? </span><span style="color:#f29718;">for help</span><span style="color:#f29668;">.
</span><span style="color:#f29718;">nix-repl</span><span style="color:#f29668;">&gt; </span><span style="color:#ff3333;">:</span><span style="color:#f29668;">?
</span><span style="color:#f29718;">The following commands are available</span><span>:
</span><span>
</span><span>  </span><span style="color:#c2d94c;">&lt;expr&gt;                       </span><span style="color:#f29718;">Evaluate and print expression
</span><span>  </span><span style="color:#c2d94c;">&lt;x&gt; </span><span style="color:#ff3333;">= </span><span style="color:#c2d94c;">&lt;expr&gt;                 </span><span style="color:#f29718;">Bind expression to variable
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">a</span><span style="color:#ff3333;">, :</span><span style="color:#f29718;">add </span><span style="color:#c2d94c;">&lt;expr&gt;              </span><span style="color:#f29718;">Add attributes from resulting set to scope
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">b </span><span style="color:#c2d94c;">&lt;expr&gt;                    </span><span style="color:#f29718;">Build a </span><span style="color:#f07178;">derivation
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">bl </span><span style="color:#c2d94c;">&lt;expr&gt;                   </span><span style="color:#f29718;">Build a </span><span style="color:#f07178;">derivation</span><span style="color:#ff3333;">, </span><span style="color:#f29718;">creating GC roots </span><span style="color:#ff3333;">in </span><span style="color:#f29718;">the
</span><span>                               </span><span style="color:#f29718;">working directory
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">e</span><span style="color:#ff3333;">, :</span><span style="color:#f29718;">edit </span><span style="color:#c2d94c;">&lt;expr&gt;             </span><span style="color:#f29718;">Open package </span><span style="color:#f29668;">or </span><span style="color:#f29718;">function </span><span style="color:#ff3333;">in $</span><span style="color:#f29718;">EDITOR
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">i </span><span style="color:#c2d94c;">&lt;expr&gt;                    </span><span style="color:#f29718;">Build </span><span style="color:#f07178;">derivation</span><span style="color:#ff3333;">, then </span><span style="color:#f29718;">install result into
</span><span>                               </span><span style="color:#f29718;">current profile
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">l</span><span style="color:#ff3333;">, :</span><span style="color:#f29718;">load </span><span style="color:#c2d94c;">&lt;path&gt;             </span><span style="color:#f29718;">Load Nix expression and add it to scope
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">lf</span><span style="color:#ff3333;">, :</span><span style="color:#f29718;">load-flake </span><span style="color:#c2d94c;">&lt;ref&gt;       </span><span style="color:#f29718;">Load Nix flake and add it to scope
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">p</span><span style="color:#ff3333;">, :</span><span style="color:#f29718;">print </span><span style="color:#c2d94c;">&lt;expr&gt;            </span><span style="color:#f29718;">Evaluate and print expression recursively
</span><span>                               </span><span style="color:#f29718;">Strings are printed directly</span><span style="color:#ff3333;">, </span><span style="color:#f29718;">without escaping</span><span style="color:#f29668;">.
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">q</span><span style="color:#ff3333;">, :</span><span style="color:#f29718;">quit                    Exit nix-repl
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">r</span><span style="color:#ff3333;">, :</span><span style="color:#f29718;">reload                  Reload all files
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">sh </span><span style="color:#c2d94c;">&lt;expr&gt;                   </span><span style="color:#f29718;">Build dependencies of </span><span style="color:#f07178;">derivation</span><span style="color:#ff3333;">, then </span><span style="color:#f29718;">start
</span><span>                               </span><span style="color:#f29718;">nix-shell
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">t </span><span style="color:#c2d94c;">&lt;expr&gt;                    </span><span style="color:#f29718;">Describe result of evaluation
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">u </span><span style="color:#c2d94c;">&lt;expr&gt;                    </span><span style="color:#f29718;">Build </span><span style="color:#f07178;">derivation</span><span style="color:#ff3333;">, then </span><span style="color:#f29718;">start nix-shell
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">doc </span><span style="color:#c2d94c;">&lt;expr&gt;                  </span><span style="color:#f29718;">Show documentation of a builtin function
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">log </span><span style="color:#c2d94c;">&lt;expr&gt;                  </span><span style="color:#f29718;">Show logs for a </span><span style="color:#f07178;">derivation
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">te</span><span style="color:#ff3333;">, :</span><span style="color:#f29718;">trace-enable </span><span>[</span><span style="color:#f29718;">bool</span><span>]    </span><span style="color:#f29718;">Enable</span><span style="color:#ff3333;">, </span><span style="color:#f29718;">disable </span><span style="color:#f29668;">or </span><span style="color:#f29718;">toggle showing traces for
</span><span>                               </span><span style="color:#f29718;">errors
</span><span>  </span><span style="color:#ff3333;">:</span><span style="color:#f29668;">?</span><span style="color:#ff3333;">, :</span><span style="color:#f29718;">help                    Brings up this help menu
</span></code></pre>
<h2 id="load-directly-nix-expressions">Load directly Nix expressions</h2>
<p>You can quickly evaluate a random Nix expression:</p>
<pre data-lang="nix" style="background-color:#0f1419;color:#bfbab0;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#f29718;">nix repl </span><span style="color:#f29668;">--</span><span style="color:#f29718;">expr </span><span style="color:#ff3333;">&#39;</span><span>{</span><span style="color:#ffb454;">a </span><span style="color:#f29668;">= </span><span>{ </span><span style="color:#ffb454;">b </span><span style="color:#f29668;">= </span><span style="color:#f29718;">3</span><span style="color:#bfbab0cc;">; </span><span style="color:#ffb454;">c </span><span style="color:#f29668;">= </span><span style="color:#f29718;">4</span><span style="color:#bfbab0cc;">; </span><span>}</span><span style="color:#bfbab0cc;">; </span><span>}</span><span style="color:#ff3333;">&#39;
</span><span>
</span><span style="color:#f29718;">Welcome to Nix 2</span><span style="color:#f29668;">.</span><span style="color:#f29718;">11</span><span style="color:#f29668;">.</span><span style="color:#f29718;">0</span><span style="color:#f29668;">. </span><span style="color:#f29718;">Type </span><span>:</span><span style="color:#ff3333;">? </span><span style="color:#f29718;">for help</span><span style="color:#f29668;">.
</span><span>
</span><span style="color:#f29718;">Loading installable </span><span style="color:#c2d94c;">&#39;&#39;...
</span><span style="color:#c2d94c;">Added 1 variables.
</span><span style="color:#c2d94c;">nix-repl&gt; a
</span><span style="color:#c2d94c;">{ b = 3; c = 4; }
</span></code></pre>
<ul>
<li>The <code>--expr</code> flag is helpful to prime directly the Nix REPL with valuable data
or values.</li>
</ul>
<h2 id="load-flakes">Load Flakes</h2>
<p>We can use the <code>--expr</code> flag to load a random Nix Flake directly:</p>
<pre data-lang="nix" style="background-color:#0f1419;color:#bfbab0;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#f29718;">nix repl </span><span style="color:#f29668;">--</span><span style="color:#f29718;">expr </span><span style="color:#ff3333;">&#39;</span><span style="color:#f29718;">builtins</span><span style="color:#f29668;">.</span><span style="color:#f29718;">getFlake </span><span style="color:#c2d94c;">&quot;github:nix-community/ethereum.nix&quot;</span><span style="color:#ff3333;">&#39;
</span></code></pre>
<p>Also, you can load a flake directly inside the REPL with <code>:load-flake</code> or <code>:lf</code>:</p>
<pre data-lang="nix" style="background-color:#0f1419;color:#bfbab0;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#f29718;">nix repl
</span><span>
</span><span style="color:#f29718;">nix-repl</span><span style="color:#f29668;">&gt; </span><span style="color:#ff3333;">:</span><span style="color:#f29718;">lf </span><span style="color:#c2d94c;">github:nix-community/home-manager
</span></code></pre>
<h3 id="debugging-with-a-flake-repl-output">Debugging with a Flake REPL output</h3>
<ul>
<li>One way to do this is to launch the repl with <code>nix repl</code> and inside the repl type <code>:lf /path/to/flake</code>. Or <code>nixos-rebuild repl --flake /path/to/flake</code> the latter provides a helpful welcome script showing what is loaded into your repl's scope.</li>
</ul>
<p>I like to create a simple repl output to load your flake into the environment with <code>nix repl .#repl</code>.</p>
<p>First, we'll create a REPL environment to inspect and debug our flake's outputs,packages, and configurations. Define a <code>repl</code> output in <code>flake.nix</code> for easy access with <code>nix repl .#repl</code>:</p>
<pre data-lang="nix" style="background-color:#0f1419;color:#bfbab0;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="font-style:italic;color:#5c6773;"># flake.nix
</span><span style="color:#f29718;">outputs </span><span style="color:#ff3333;">= </span><span>{ </span><span style="color:#f29718;">self</span><span style="color:#f29668;">, </span><span style="color:#f29718;">nixpkgs</span><span style="color:#f29668;">, ... </span><span>}: </span><span style="color:#ff7733;">let
</span><span>  </span><span style="color:#ffb454;">pkgs </span><span style="color:#f29668;">= </span><span style="color:#f07178;">import </span><span style="color:#f29718;">nixpkgs </span><span>{ </span><span style="color:#ffb454;">system </span><span style="color:#f29668;">= </span><span style="color:#c2d94c;">&quot;x86_64-linux&quot;</span><span style="color:#bfbab0cc;">; </span><span>}</span><span style="color:#bfbab0cc;">;
</span><span style="color:#ff7733;">in </span><span>{
</span><span>  </span><span style="color:#ffb454;">repl </span><span style="color:#f29668;">= </span><span style="color:#f07178;">import </span><span style="color:#c2d94c;">./repl.nix </span><span>{
</span><span>    </span><span style="color:#ff7733;">inherit </span><span>(</span><span style="color:#f29718;">pkgs</span><span>) </span><span style="color:#ffb454;">lib</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ffb454;">flake </span><span style="color:#f29668;">= </span><span style="color:#f29718;">self</span><span style="color:#bfbab0cc;">;
</span><span>    </span><span style="color:#ffb454;">pkgs </span><span style="color:#f29668;">= </span><span style="color:#f29718;">pkgs</span><span style="color:#bfbab0cc;">;
</span><span>  }</span><span style="color:#bfbab0cc;">;
</span><span>}</span><span style="color:#ff3333;">;
</span></code></pre>
<p>And in <code>repl.nix</code>:</p>
<pre data-lang="nix" style="background-color:#0f1419;color:#bfbab0;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="font-style:italic;color:#5c6773;"># repl.nix
</span><span>{
</span><span>  </span><span style="color:#f29718;">lib</span><span style="color:#f29668;">,
</span><span>  </span><span style="color:#f29718;">flake</span><span style="color:#f29668;">,
</span><span>  </span><span style="color:#f29718;">pkgs</span><span style="color:#f29668;">,
</span><span>}: {
</span><span>  </span><span style="color:#ff7733;">inherit </span><span style="color:#ffb454;">flake pkgs lib</span><span style="color:#bfbab0cc;">;
</span><span>  </span><span style="color:#ffb454;">configs </span><span style="color:#f29668;">= </span><span style="color:#f29718;">flake</span><span style="color:#f29668;">.</span><span style="color:#f29718;">nixosConfigurations</span><span style="color:#bfbab0cc;">;
</span><span>}
</span></code></pre>
<h2 id="usage">Usage</h2>
<p>Load REPL environment with:
<code>nix repl .#repl</code></p>
<p>Attributes:</p>
<pre data-lang="nix" style="background-color:#0f1419;color:#bfbab0;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#f29718;">nix-repl</span><span style="color:#f29668;">&gt; </span><span style="color:#f29718;">builtins</span><span style="color:#f29668;">.</span><span style="color:#f29718;">attrNames flake</span><span style="color:#f29668;">.</span><span style="color:#f29718;">inputs
</span><span>[
</span><span>  </span><span style="color:#c2d94c;">&quot;dont-track-me&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;helix&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;home-manager&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;hyprland&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;neovim-nightly-overlay&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;nixpkgs&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;nvf&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;rose-pine-hyprcursor&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;stylix&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;treefmt-nix&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;wallpapers&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;wezterm&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;yazi&quot;
</span><span>]
</span><span style="color:#f29718;">nix-repl</span><span style="color:#f29668;">&gt; </span><span style="color:#f29718;">builtins</span><span style="color:#f29668;">.</span><span style="color:#f29718;">attrNames flake</span><span style="color:#f29668;">.</span><span style="color:#f29718;">outputs
</span><span>[
</span><span>  </span><span style="color:#c2d94c;">&quot;checks&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;devShells&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;formatter&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;nixosConfigurations&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;packages&quot;
</span><span>  </span><span style="color:#c2d94c;">&quot;repl&quot;
</span><span>]
</span><span style="color:#f29718;">nix-repl</span><span style="color:#f29668;">&gt; </span><span style="color:#f29718;">flake</span><span style="color:#f29668;">.</span><span style="color:#f29718;">outputs</span><span style="color:#f29668;">.</span><span style="color:#f29718;">formatter
</span><span>{
</span><span>  </span><span style="color:#ffb454;">x86_64-linux </span><span style="color:#f29668;">= </span><span style="color:#ff3333;">«</span><span style="color:#f07178;">derivation </span><span style="color:#c2d94c;">/nix/store/q71q00wmh1gnjzdrw5nrvwbr6k414036-treefmt.drv</span><span style="color:#ff3333;">»</span><span style="color:#bfbab0cc;">;
</span><span>}
</span></code></pre>
<ul>
<li>Inspect the default package output:</li>
</ul>
<pre data-lang="nix" style="background-color:#0f1419;color:#bfbab0;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#f29718;">nix-repl</span><span style="color:#f29668;">&gt; </span><span style="color:#f29718;">flake</span><span style="color:#f29668;">.</span><span style="color:#f29718;">outputs</span><span style="color:#f29668;">.</span><span style="color:#f29718;">packages</span><span style="color:#f29668;">.</span><span style="color:#f29718;">x86_64-linux</span><span style="color:#f29668;">.</span><span style="color:#f29718;">default
</span><span style="color:#ff3333;">«</span><span style="color:#f07178;">derivation </span><span style="color:#c2d94c;">/nix/store/6kp660mm62saryskpa1f2p6zwfalcx2w-default-tools.drv</span><span style="color:#ff3333;">»
</span></code></pre>
<ul>
<li>
<p>From here out I'll leave out the <code>nix-repl&gt;</code> prefix just know that it's there.</p>
</li>
<li>
<p>Check lib version(Nixpkgs <code>lib</code> attribute):</p>
</li>
</ul>
<pre data-lang="nix" style="background-color:#0f1419;color:#bfbab0;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#f29718;">lib</span><span style="color:#f29668;">.</span><span style="color:#f29718;">version
</span><span style="color:#c2d94c;">&quot;25.05pre-git&quot;
</span></code></pre>
<ul>
<li>List systemPackages and home.packages, my hostname is <code>magic</code> list yours in its place:</li>
</ul>
<pre data-lang="nix" style="background-color:#0f1419;color:#bfbab0;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#f29718;">configs</span><span style="color:#f29668;">.</span><span style="color:#f29718;">magic</span><span style="color:#f29668;">.</span><span style="color:#f29718;">config</span><span style="color:#f29668;">.</span><span style="color:#f29718;">environment</span><span style="color:#f29668;">.</span><span style="color:#f29718;">systemPackages
</span><span style="font-style:italic;color:#5c6773;"># list home.packages
</span><span style="color:#f29718;">configs</span><span style="color:#f29668;">.</span><span style="color:#f29718;">magic</span><span style="color:#f29668;">.</span><span style="color:#f29718;">config</span><span style="color:#f29668;">.</span><span style="color:#f29718;">home-manager</span><span style="color:#f29668;">.</span><span style="color:#f29718;">users</span><span style="color:#f29668;">.</span><span style="color:#f29718;">jr</span><span style="color:#f29668;">.</span><span style="color:#f29718;">home</span><span style="color:#f29668;">.</span><span style="color:#f29718;">packages
</span></code></pre>
<ul>
<li>Or an individual value:</li>
</ul>
<pre data-lang="nix" style="background-color:#0f1419;color:#bfbab0;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#ff3333;">:</span><span style="color:#f29718;">p configs</span><span style="color:#f29668;">.</span><span style="color:#f29718;">magic</span><span style="color:#f29668;">.</span><span style="color:#f29718;">config</span><span style="color:#f29668;">.</span><span style="color:#f29718;">home-manager</span><span style="color:#f29668;">.</span><span style="color:#f29718;">users</span><span style="color:#f29668;">.</span><span style="color:#f29718;">jr</span><span style="color:#f29668;">.</span><span style="color:#f29718;">programs</span><span style="color:#f29668;">.</span><span style="color:#f29718;">git</span><span style="color:#f29668;">.</span><span style="color:#f29718;">userName
</span><span style="color:#f29718;">TSawyer87
</span></code></pre>
<h3 id="debugging">Debugging</h3>
<ul>
<li>Check if the module system is fully evaluating, anything other than a "set" the configuration isn't fully evaluated (e.g. "lambda" might indicate an unevaluated thunk):</li>
</ul>
<pre data-lang="nix" style="background-color:#0f1419;color:#bfbab0;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#ff3333;">:</span><span style="color:#f29718;">p builtins</span><span style="color:#f29668;">.</span><span style="color:#f29718;">typeOf configs</span><span style="color:#f29668;">.</span><span style="color:#f29718;">magic
</span><span style="color:#f29718;">set
</span></code></pre>
<ul>
<li>
<p>Debugging Module System:</p>
</li>
<li>
<p>Check if <code>configs.magic</code> is a valid configuration:</p>
</li>
</ul>
<pre data-lang="nix" style="background-color:#0f1419;color:#bfbab0;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#ff3333;">:</span><span style="color:#f29718;">p builtins</span><span style="color:#f29668;">.</span><span style="color:#f29718;">attrNames configs</span><span style="color:#f29668;">.</span><span style="color:#f29718;">magic
</span></code></pre>
 </div>
    </section>
  </body>
</html>
