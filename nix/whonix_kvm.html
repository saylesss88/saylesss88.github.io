<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Whonix KVM on NixOS - nix-book</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <a href="#" class="top-link" id="back-to-top">â†‘</a>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">nix-book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="whonix-kvm-on-nixos"><a class="header" href="#whonix-kvm-on-nixos">Whonix KVM on NixOS</a></h1>
<details>
<summary> Click to Expand Table of Contents</summary>
<!-- toc -->
</details>
<p><img src="../images/swappy-20250901-101339.cleaned.png" alt="Whonix Logo" /></p>
<blockquote>
<p>âš ï¸ WARNING: There is no general software that can guarantee absolute anonymity
or security; perfect security is a myth. Security is a continuous process, not
a one-time product. It also depends on time and resources: if an adversary has
enough of either, eventual compromise is probable. However, by layering
defenses and following best practices, we can make attacks costly and
time-consuming, deterring all but highly targeted adversaries.</p>
</blockquote>
<p>It is highly recommended to harden your Host Machine as Type 2 hypervisors are
only as secure as their host. KVM is actually a type 1 hypervisor but relies on
QEMU for emulation which is a Type 2 hypervisor. This actually makes it a sort
of hybrid in between Type 1 and Type 2 but is in theory less secure than running
a Xen hypervisor (Type 1) on bare-metal.</p>
<p>Whonix offers many benefits, including the convenience of running within your
current operating system without needing to reboot or use a separate Tails USB.
It provides similar strong anonymity protections by routing all traffic through
Tor in isolated virtual machines. The Whonix documentation is transparent about
its limitations, which helps build trust and confidence in its security model.</p>
<ul>
<li>
<p><a href="https://www.whonix.org/wiki/Comparison_with_Others">Whonix Compared to Tails</a></p>
</li>
<li>
<p>Tails is great but they add an add blocker to Tor that makes every Tails user
unique from the rest of Tor Browser users reducing anonymity.</p>
</li>
</ul>
<blockquote>
<p>âš ï¸ Never rely solely on the Virtual Machine to protect you, if your host OS
isn't secure a Virtual Machine won't protect you. If you have high threat
model, you may want to choose a Host with better support for AppArmor and
Selinux as they are highly limited on NixOS.</p>
</blockquote>
<p>That being said, there is a lot you can do to harden NixOS...</p>
<h3 id="harden-nixos-and-set-up-gnupg"><a class="header" href="#harden-nixos-and-set-up-gnupg">Harden NixOS and set up GnuPG</a></h3>
<ul>
<li>
<p><a href="https://saylesss88.github.io/nix/hardening_NixOS.html">Hardening NixOS</a></p>
</li>
<li>
<p><a href="https://saylesss88.github.io/nix/hardening_networking.html">Hardening Networking</a></p>
</li>
<li>
<p><a href="https://saylesss88.github.io/nix/gpg-agent.html">GnuPG and gpg-agent on NixOS</a></p>
</li>
</ul>
<h3 id="a-few-things-to-consider-when-using-whonix"><a class="header" href="#a-few-things-to-consider-when-using-whonix">A Few Things to Consider when using Whonix</a></h3>
<ul>
<li>
<p>No activity conducted inside <code>Whonix-Workstation</code> can cause IP/DNS leaks so
long as <code>Whonix-Gateway</code> is left unchanged or only documented changes are made
like configuring bridges, establishing onion services and running updates.</p>
</li>
<li>
<p>Whonix does not and does not claim to protect users against advanced
adversaries such as nation state actors, if they target you, you will be
infected! If used correctly, Whonix can provide partial protection against
passive surveillance programs, it all depends on whether Tor can provide
adequate protection or not, which is not clear at this time.</p>
</li>
<li>
<p>You shouldn't use a VPN with Whonix and it is obvious that you're using Tor
because connections are made to known Tor Relays, which are publicly listed
and identifiable.</p>
</li>
</ul>
<blockquote>
<p>âš ï¸It is impossible to Hide Tor use from the internet service provider (ISP).
It has been concluded this goal is difficult beyond practicality.
--<a href="https://www.whonix.org/wiki/Hide_Tor_from_your_Internet_Service_Provider">Whonix Hide Tor from your ISP</a></p>
</blockquote>
<ul>
<li>
<p>Millions of people use Tor daily for wholly legitimate reasons, particularly
to assert their privacy rights when faced with countless corporate /
government network observers and censors.</p>
</li>
<li>
<p>True anonymity is very difficult to successfully pull off and not something
that you can maintain for a long time.</p>
<ul>
<li><a href="https://www.whonix.org/wiki/Tips_on_Remaining_Anonymous">Whonix Tips for remaining Anonymous</a></li>
</ul>
</li>
</ul>
<h2 id="-key-terms"><a class="header" href="#-key-terms">ğŸ”‘ Key Terms</a></h2>
<p>Whonix is an operating system based on Debian base (Kicksecure Hardened) and the
Tor network, which is designed for maximum anonymity and security. Whonix
consists of two Debian based VMs, the <code>Whonix-Gateway</code> and <code>Whonix-Workstation</code>.</p>
<p>In this case NixOS is the <strong>Host Operating System</strong>, NixOS runs the KVM kernel
module, libvirtd service, and QEMU virtualization service which together enable
hosting VMs. It is recommended to harden the host before moving on.</p>
<p><strong>Guests</strong> are the virtualized operating systems running inside the host's
virtual machines. In this case the Whonix VMs are the <strong>Guest Machines</strong>.</p>
<p><code>Whonix-Gateway</code> the first of 2 VMs runs Tor processes and forces all traffic
through the Tor network using iptables.</p>
<p><code>Whonix-Workstation</code> the second VM, is responsible for running user applications
such as the Tor Browser. The Whonix-Workstation is isolated from both the
Whonix-Gateway and the Host OS, if an app misbehaves, it is contained within the
isolated Whonix-Workstation. It is largely unaware of sensitive info and won't
leak unless an advanced adversary is able to break out of the VM.</p>
<p>The primary goal of Whonix is to be safer than Tor alone and that no one can
find out the user's IP, location, or de-anonymize the user. It offers full
spectrum anti-tracking protection that is much safer than VPNs. Whonix provides
this through security by isolation, no app is trusted.</p>
<p><code>Whonix Concept</code>: Whonix is an Isolating Proxy with an additional Transparent
Proxy, which can be optionally disabled. --Whonix Docs</p>
<p>Since Whonix is based on Kicksecure which is based on Debian stable, you can
typically look up solutions in a Kicksecure, Debian, or Ubuntu forum.</p>
<ul>
<li>The Whonix Team recommends KVM over VirtualBox for a number of
reasons:<a href="https://www.whonix.org/wiki/KVM#Why_Use_KVM_Over_VirtualBox?">Why choose KVM over VirtualBox</a></li>
</ul>
<p>If you really want to use VirtualBox, I got it working off of this config:</p>
<p>VirtualBox = Type 2 hypervisor</p>
<details>
<summary> âœ”ï¸ Click to Expand VirtualBox Example </summary>
<p>Change <code>your-user</code> to your username</p>
<pre><code class="language-nix"># vbox.nix
{
  config,
  lib,
  ...
}: let
  cfg = config.custom.virtualbox;
in {
  options.custom.virtualbox = {
    enable = lib.mkEnableOption "Enable VirtualBox";
  };

  config = lib.mkIf cfg.enable {
    virtualisation.virtualbox.host = {
      enable = false;
      # enableExtensionPack = true;
    };

    user.user.your-user.extraGroups = ["vboxusers"];

    boot.kernelModules =
      if config.hardware.cpu.amd.updateMicrocode
      then ["kvm-amd"]
      else ["kvm-intel"];
  };
}
</code></pre>
<p>Enable it with <code>custom.virtualbox.enable = true;</code>.</p>
<ul>
<li><a href="https://www.whonix.org/wiki/VirtualBox">Whonix VBox Download</a></li>
</ul>
<p>After rebuilding with virtualbox enabled and downloading the virtualbox whonix,
open VirtualBox and import the Whonix file.</p>
<p>Fix the error:: VirtualBox can't enable the AMD-V extension. Please disable the
KVM kernel extension:</p>
<p>If both of these are active, they compete with each other:</p>
<pre><code class="language-bash">sudo lsmod | grep -E 'kvm|vbox'
</code></pre>
<p>Check the currently in use modules:</p>
<pre><code class="language-bash">modprobe -r kvm
</code></pre>
<p>Disable kvm and kvm_amd:</p>
<pre><code class="language-bash">sudo rmmod kvm_amd
sudo rmmod kvm
# To re-enable them when necessary
# sudo modprobe kvm
# sudo modprobe kvm_amd
</code></pre>
<ul>
<li><a href="https://atetux.com/quick-fix-virtualbox-cant-enable-the-amd-v-extension">Quick fix</a></li>
</ul>
<p>There is an opposite viewpoint,
<a href="https://www.whonix.org/wiki/Dev/VirtualBox#Why_use_VirtualBox_over_KVM?">Why choose VirtualBox over KVM</a></p>
</details>
<h2 id="whonix-gateway"><a class="header" href="#whonix-gateway">Whonix-Gateway</a></h2>
<p>The whonix-gateway is software designed to run Tor.</p>
<p>The Gateway acts as a firewall and is what is routing all your traffic through
Tor.</p>
<p>You will spend minimal time in the Gateway, it's mainly used for Tor
configuration which is reserved for advanced users.</p>
<h3 id="whonix-workstation"><a class="header" href="#whonix-workstation">Whonix-Workstation</a></h3>
<p>All user applications should only be launched from Whonix-Workstation to ensure
they utilize the Tor network. (Never launch the Tor browser or any other user
app from Whonix-Gateway.)</p>
<p>Leaky applications can't breakout of the Workstation, all network connections
are forced to go through the Whonix-Gateway where they are torrified and routed
to the internet.</p>
<h2 id="whonix-kvm-kernel-virtual-machine-on-nixos"><a class="header" href="#whonix-kvm-kernel-virtual-machine-on-nixos">Whonix KVM (Kernel Virtual Machine) on NixOS</a></h2>
<p><strong>KVM</strong> (Kernel-based Virtual Machine) is a Linux kernel module that provides
hardware-assisted virtualization.</p>
<p>It allows the Linux kernel to act as a hypervisor, enabling virtual machines
(VMs) to run with near-native speeds by using CPU virtualization extensions
(Intel VT-x or AMD-V).</p>
<p>KVM itself doesnâ€™t handle the entire VM lifecycle; it provides the core
virtualization infrastructure.</p>
<p><strong>QEMU</strong> (Quick Emulator) is an open-source user-space program that emulates
hardware for virtual machines.</p>
<p>When combined with KVM, QEMU uses hardware acceleration to run VMs much faster
by offloading CPU virtualization to KVM.</p>
<p>So, QEMU provides the device emulation and VM management interface, while KVM
provides the fast virtualization engine within the kernel.</p>
<p><strong>Install Qemu-KVM</strong>:</p>
<pre><code class="language-nix">{
  config,
  pkgs,
  ...
}: {
  ##  QEMU-KVM
  environment.systemPackages = with pkgs; [
    qemu
    # Optional
    virt-viewer
  ];

  # Virt-Manager GUI
  programs.virt-manager.enable = true;
  virtualisation = {
    # libvirtd daemon
    libvirtd = {
      enable = true;
      qemu = {
        # enables a TPM emulator
        swtpm.enable = true;
      };
    };
    # allow USB device to be forwarded
    spiceUSBRedirection.enable = true;
  };
  # Spice protocol improves VM display and input responsiveness
  services.spice-vdagentd.enable = true;
}
</code></pre>
<hr />
<p>The <strong>libvirtd</strong> is the primary daemon (service) in the libvirt virtualization
management system. It runs on your host machine and acts as the core management
component for virtual machines (VMs).</p>
<p>Add <code>libvirtd</code> &amp; <code>kvm</code> to your users <code>extraGroups</code>:</p>
<pre><code class="language-nix">users.users = {
    your-user = {
        extraGroups = [
            "libvirtd"
            "kvm"
        ];
    };
};
</code></pre>
<p>Restart <code>libvirtd</code>:</p>
<pre><code class="language-bash">sudo systemctl restart libvirtd
</code></pre>
<hr />
<h2 id="network-start"><a class="header" href="#network-start">Network Start</a></h2>
<p>Ensure KVM's / QEMU's default network is enabled and has started:</p>
<pre><code class="language-bash">sudo virsh -c qemu:///system net-autostart default
</code></pre>
<pre><code class="language-bash">sudo virsh -c qemu:///system net-start default
</code></pre>
<hr />
<h3 id="download-whonix-kvm-stable"><a class="header" href="#download-whonix-kvm-stable">Download Whonix (KVM) (stable)</a></h3>
<ol>
<li>
<p><a href="https://www.whonix.org/download/libvirt/17.4.4.6/Whonix-Xfce-17.4.4.6.Intel_AMD64.qcow2.libvirt.xz">Whonix (KVM) (stable) Download</a></p>
</li>
<li>
<p>Go to <a href="https://www.whonix.org/wiki/KVM">whoniix.org</a> to verify the signature.
Download the <code>OpenPGP Signature</code>, and the <code>Download Whonix OpenPGP Key</code>. Your
Downloads directory will look like this:</p>
</li>
</ol>
<pre><code class="language-bash">~/Downloadsî‚ºó°«î‚´ ls
â•­â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ # â”‚                         name                          â”‚ type â”‚  size   â”‚   modified    â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0 â”‚ Whonix-Xfce-17.4.4.6.Intel_AMD64.qcow2.libvirt.xz     â”‚ file â”‚  3.3 GB â”‚ 2 minutes ago â”‚
â”‚ 1 â”‚ Whonix-Xfce-17.4.4.6.Intel_AMD64.qcow2.libvirt.xz.asc â”‚ file â”‚  1.0 kB â”‚ a minute ago  â”‚
â”‚ 2 â”‚ derivative.asc                                        â”‚ file â”‚ 77.3 kB â”‚ 3 minutes ago â”‚
â•°â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
</code></pre>
<p>Import <code>derivative.asc</code>:</p>
<pre><code class="language-bash">gpg --import derivative.asc
</code></pre>
<p>Verify the Public Key:</p>
<pre><code class="language-bash">gpg --verify Whonix-Xfce-17.4.4.6.Intel_AMD64.qcow2.libvirt.xz.asc Whonix-Xfce-17.4.4.6.Intel_AMD64.qcow2.libvirt.xz
gpg: Signature made Sun 10 Aug 2025 09:04:13 AM EDT
gpg:                using RSA key 6E979B28A6F37C43BE30AFA1CB8D50BB77BB3C48
gpg: Good signature from "Patrick Schleizer &lt;adrelanos@kicksecure.com&gt;" [unknown]
gpg:                 aka "Patrick Schleizer &lt;adrelanos@riseup.net&gt;" [unknown]
gpg:                 aka "Patrick Schleizer &lt;adrelanos@whonix.org&gt;" [unknown]
gpg: WARNING: This key is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: 916B 8D99 C38E AF5E 8ADC  7A2A 8D66 066A 2EEA CCDA
     Subkey fingerprint: 6E97 9B28 A6F3 7C43 BE30  AFA1 CB8D 50BB 77BB 3C48
~/Downloadsî‚ºó°«î‚´                                                                                                 09/04/2025 11:53:10 AM
</code></pre>
<p>Now <code>gpg --list-keys</code> will show Patrick Schleizer's Key.</p>
<p>It is good practice to sign your verified key and then push it to the public
keyserver to contribute to the web of trust but optional.</p>
<ol start="3">
<li><a href="https://www.whonix.org/wiki/KVM#Decompress">Decompress the Image</a> and follow
the rest of the Whonix KVM install instructions from there.</li>
</ol>
<p>Nixpkgs doesn't have the <code>xz-utils</code> package but it does have the <code>xz</code> package.</p>
<p>Nixpkgs also has <code>nixpkgs.safe-rm</code> if you wanted to follow the suggestions from
Whonix.</p>
<pre><code class="language-bash">nix-shell -p xz safe-rm
</code></pre>
<pre><code class="language-bash">tar -xvf Whonix*.libvirt.xz
</code></pre>
<hr />
<h3 id="import-the-whonix-vm-templates"><a class="header" href="#import-the-whonix-vm-templates">Import the Whonix VM Templates</a></h3>
<p>The following commands come directly from the
<a href="https://www.whonix.org/wiki/KVM#Importing_Whonix_VM_Templates">Whonix KVM Docs Importing Whonix VM Templates</a></p>
<ol>
<li>Add the virtual networks. This step only needs to be done once and not with
every upgrade.</li>
</ol>
<pre><code class="language-bash">sudo virsh -c qemu:///system net-define Whonix_external*.xml
</code></pre>
<pre><code class="language-bash">sudo virsh -c qemu:///system net-define Whonix_internal*.xml
</code></pre>
<ol start="2">
<li>Activate the virtual networks:</li>
</ol>
<pre><code class="language-bash">sudo virsh -c qemu:///system net-autostart Whonix-External
</code></pre>
<pre><code class="language-bash">sudo virsh -c qemu:///system net-start Whonix-External
</code></pre>
<pre><code class="language-bash">sudo virsh -c qemu:///system net-autostart Whonix-Internal
</code></pre>
<pre><code class="language-bash">sudo virsh -c qemu:///system net-start Whonix-Internal
</code></pre>
<ol start="3">
<li>Import the Whonix Gateway and Workstation images:</li>
</ol>
<pre><code class="language-bash">sudo virsh -c qemu:///system define Whonix-Gateway*.xml
</code></pre>
<pre><code class="language-bash">sudo virsh -c qemu:///system define Whonix-Workstation*.xml
</code></pre>
<p>After the above steps, either copy or move the <code>qcow2</code> images to
<code>/var/lib/libvirt/images</code>:</p>
<blockquote>
<p>â— It's recommended to move the files into place, if you want to copy them you
need to use a special command FYI.</p>
</blockquote>
<pre><code class="language-bash">sudo mkdir -p /var/lib/libvirt/images
</code></pre>
<pre><code class="language-bash">sudo mv Whonix-Gateway*.qcow2 /var/lib/libvirt/images/Whonix-Gateway.qcow2
</code></pre>
<pre><code class="language-bash">sudo mv Whonix-Workstation*.qcow2 /var/lib/libvirt/images/Whonix-Workstation.qcow2
</code></pre>
<h3 id="cleanup"><a class="header" href="#cleanup">Cleanup</a></h3>
<pre><code class="language-bash">safe-rm Whonix*
</code></pre>
<pre><code class="language-bash">safe-rm -r WHONIX*
</code></pre>
<h3 id="launch-virt-manager-and-start-the-vms"><a class="header" href="#launch-virt-manager-and-start-the-vms">Launch virt-manager and start the VMs</a></h3>
<pre><code class="language-bash">virt-manager
</code></pre>
<p>From here it will take a bit to load both VMs, you can click on one and go to
<code>Edit</code>, <code>Virtual Machine Details</code> and from there you have some options to give
the VM more CPUs and memory.</p>
<p>Considering that the Whonix-Workstation is where all of the user applications
will be opened, it makes sense to give it more CPUs and memory.</p>
<p>I've seen recommendations for a minimum of 4G of RAM for the Workstation and 2GB
for the Gateway.</p>
<ul>
<li>
<p>Increase vCPU count for better performance</p>
</li>
<li>
<p>Enable XML editing in settings</p>
</li>
<li>
<p>Enable copy pasting by adding <code>&lt;clipboard copypaste="yes"/&gt;</code></p>
</li>
</ul>
<h2 id="start-whonix-gateway"><a class="header" href="#start-whonix-gateway">Start Whonix-Gateway</a></h2>
<p><img src="../images/swappy-20250901-101351.cleaned.png" alt="Whonix Old Logo" /></p>
<p>Always start the Whonix-Gateway first.</p>
<p>Click on Whonix-Gateway, press Play, and choose the default Persistent VM.</p>
<p>To view the gateway press <code>Open</code>.</p>
<p>You can use the "System Maintenance Panel" to <code>Check for Updates</code> and then
<code>Install Updates</code>. This can also be used for user and password creation, the
default user is <code>user</code> with a passwordless login.</p>
<p>Change the password manually:</p>
<pre><code class="language-bash">sudo passwd
changeme
</code></pre>
<p>Change the passwords and disable auto-login.</p>
<p>Run a systemcheck if it wasn't run automatically. Click the Xfce Logo and go to
<code>System</code>, <code>System Check</code>.</p>
<ul>
<li><a href="https://www.whonix.org/wiki/Common_CLI_Commands">Whonix Common CLI Commands</a></li>
</ul>
<h2 id="whonix-workstation-1"><a class="header" href="#whonix-workstation-1">Whonix-Workstation</a></h2>
<p>Whonix-Workstation is another VM, designed to provide users with a secure and
anonymous environment for running applications and performing online tasks.</p>
<p>When you first launch <code>Whonix-Workstation</code>, choose the second option down or
reboot, and then choose "Persistent Mode Sysmaint Session". From there, you can
go through the same steps as you did for the Gateway.</p>
<p>With the workstation, a security feature disables <code>sudo</code> for the default user.
Instead of the <code>user</code> account, a separate <code>sysmaint</code> (system maintenance)
account is used for administrative tasks that require root privileges, such as
updates and package installations.</p>
<ul>
<li>Change all user passwords and disable auto-login</li>
</ul>
<p>After you get your system updated and upgraded, you'll want to reboot the
Workstation and start it in the first Persistent mode available rather than the
<code>sysmaint</code> mode.</p>
<p>Once Workstation is running and both VMs are updated and upgraded, check that
your IP address is a Tor IP:</p>
<pre><code class="language-bash">curl ip.me
#
curl ip.me
</code></pre>
<p>Each consecutive time that you run <code>curl ip.me</code>, Tor establishes a new circuit
and you will get a different IP returned each time for as many Tor nodes are
available. Not that you would want to but it's cool functionality giving us a
visual of the new circuit.</p>
<p>Start Tor and check what you are fingerprinted as by typing <code>deviceinfo.me</code> into
the URL.</p>
<h4 id="launching-tor-browser"><a class="header" href="#launching-tor-browser">Launching Tor Browser</a></h4>
<p>Click the Xfce logo and choose Tor Browser. On the first launch, you will need
to update Tor by clicking in the top right corner.</p>
<p>Or you can open the terminal and type:</p>
<pre><code class="language-bash">update-torbrowser
</code></pre>
<ul>
<li>Every time you run the above command, the old browser will be killed, along
with your old browser profile, including bookmarks and passwords. If the
update suggests a downgrade from your current version don't do it, it is
likely a downgrade attack.</li>
</ul>
<p>Make sure you don't forget to go to the Settings, Privacy and Security, and set
the <code>Security Level</code> to <code>Safest</code> to disable JavaScript and more before exploring
the dark web.</p>
<p>Visit <code>https://check.torproject.org</code>, you should see "Congratulations. This
browser is configured to use Tor."</p>
<p>If you need a place to start, check out <code>https://tor.taxi</code> by plugging that into
the URL. Always include the <code>https</code> yourself!</p>
<blockquote>
<p>â— NOTE: Use HTTPS and TLS wherever possible, since Tor only encrypts traffic
as it travels through the network of three nodes. Traffic at Exit nodes is
vulnerable if unencrypted, because when it reaches the Exit node it is plain
text. Prefer the use of <code>.onion</code> services because they form a tunnel that is
encrypted end-to-end, using a random rendezvous point within the Tor network;
HTTPS isn't required within Onion services. Prefer the use of <code>.onion</code>
services because they form a tunnel that is encrypted end-to-end, using a
random rendezvous point within the Tor network; HTTPS isn't required within
Onion services.
--<a href="https://www.whonix.org/wiki/Tor_Myths_and_Misconceptions#All_my_traffic_is_encrypted_by_default">All my traffic is encrypted by default?</a></p>
</blockquote>
<h2 id="live-mode"><a class="header" href="#live-mode">Live Mode</a></h2>
<p>To get Whonix to perform more similarly to Tails you could run Whonix in Live
Mode. Live Mode is a privacy-focused mode where nothing is saved at shutdown,
making it great for handling sensitive data.</p>
<ul>
<li><a href="https://www.kicksecure.com/wiki/Live_Mode">Live Mode</a></li>
</ul>
<p>Same process, reboot the Workstation and Choose
<code>LIVE Mode | USER Session | disposable use</code></p>
<ul>
<li><a href="https://www.kicksecure.com/wiki/Anti-Forensics_Precautions">Anti Forensics Precautions</a></li>
</ul>
<h2 id="download-and-verify-kicksecure-kvm"><a class="header" href="#download-and-verify-kicksecure-kvm">Download and Verify Kicksecure KVM</a></h2>
<ul>
<li><a href="https://www.kicksecure.com/wiki/KVM">Kicksecure KVM wiki</a></li>
</ul>
<ol>
<li>
<p><a href="https://www.kicksecure.com/download/libvirt/17.4.4.6/Kicksecure-Xfce-17.4.4.6.Intel_AMD64.qcow2.libvirt.xz">Download Kicksecure Xfce (KVM) (stable) (FREE!)</a></p>
</li>
<li>
<p><a href="https://www.kicksecure.com/download/libvirt/17.4.4.6/Kicksecure-Xfce-17.4.4.6.Intel_AMD64.qcow2.libvirt.xz.asc">Download OpenPGP Signature</a></p>
</li>
<li>
<p><a href="https://www.kicksecure.com/keys/derivative.asc">Download Kicksecure OpenPGP Key</a></p>
</li>
<li>
<p>Import the <code>derivative.asc</code> file:</p>
</li>
</ol>
<pre><code class="language-bash">gpg --import derivative.asc
</code></pre>
<ol start="5">
<li>Make sure both files are done downloading and run the following to verify,
your file names might be slightly different:</li>
</ol>
<pre><code class="language-bash">gpg --verify Kicksecure-Xfce-17.4.4.6.Intel_AMD64.qcow2.libvirt.xz.asc Kicksecure-Xfce-17.4.4.6.Intel_AMD64.qcow2.libvirt.xz
gpg: Signature made Sun 10 Aug 2025 07:32:52 AM EDT
gpg:                using RSA key 6E979B28A6F37C43BE30AFA1CB8D50BB77BB3C48
gpg: Good signature from "Patrick Schleizer &lt;adrelanos@kicksecure.com&gt;" [unknown]
gpg:                 aka "Patrick Schleizer &lt;adrelanos@riseup.net&gt;" [unknown]
gpg:                 aka "Patrick Schleizer &lt;adrelanos@whonix.org&gt;" [unknown]
gpg: WARNING: This key is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: 916B 8D99 C38E AF5E 8ADC  7A2A 8D66 066A 2EEA CCDA
     Subkey fingerprint: 6E97 9B28 A6F3 7C43 BE30  AFA1 CB8D 50BB 77BB 3C48
</code></pre>
<ol start="6">
<li><strong>Decompress</strong></li>
</ol>
<pre><code class="language-bash">tar -xvf Kicksecure*.libvirt.xz
</code></pre>
<p>Don't use <code>unxz</code>!</p>
<h3 id="resources"><a class="header" href="#resources">Resources</a></h3>
<ul>
<li>
<p><a href="https://www.whonix.org/wiki/Documentation">Whonix Docs</a></p>
</li>
<li>
<p><a href="https://www.whonix.org/wiki/About">Whonix Overview</a></p>
</li>
<li>
<p><a href="https://www.whonix.org/wiki/Dev/Technical_Introduction">Whonix Technical Intro</a></p>
</li>
<li>
<p><a href="https://www.kicksecure.com/wiki/Computer_Security_Introduction">Kicksecure Computer Security Intro</a></p>
</li>
<li>
<p><a href="https://www.kicksecure.com/wiki/Computer_Security_Introduction#Advanced_Security_Guide">Kicksecure Advanced Security Guide</a></p>
</li>
</ul>
<p>k
<a href="https://www.kicksecure.com/wiki/System_Hardening_Checklist">System Hardening Checklist</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../nix/hardening_networking.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../nix/kvm.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../nix/hardening_networking.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../nix/kvm.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
