<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Derivations_explained | NixOS Blog</title>
<link rel=icon href=favicon.svg sizes=any type=image/svg+xml><meta property="og:url" content="https://TSawyer87.github.io/posts/derivations_explained/"><meta property="og:site_name" content="NixOS Blog"><meta property="og:title" content="Derivations_explained"><meta property="og:description" content="Introduction to Nix Derivations A derivation in Nix is a fundamental concept that describes how to build a piece of software or a resource (e.g., a package, library, or configuration file). Think of it as a recipe for creating something within the Nix ecosystem.
For beginners, the analogy of a cooking recipe is helpful:
Ingredients (Dependencies): What other software or libraries are needed. Steps (Build Instructions): The commands to compile, configure, and install. Final Dish (Output): The resulting package or resource. A Nix derivation encapsulates all this information, telling Nix what inputs to use, how to build it, and what the final output should be."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-14T19:25:48-04:00"><meta property="article:modified_time" content="2025-05-14T19:25:48-04:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Derivations_explained"><meta name=twitter:description content="Introduction to Nix Derivations A derivation in Nix is a fundamental concept that describes how to build a piece of software or a resource (e.g., a package, library, or configuration file). Think of it as a recipe for creating something within the Nix ecosystem.
For beginners, the analogy of a cooking recipe is helpful:
Ingredients (Dependencies): What other software or libraries are needed. Steps (Build Instructions): The commands to compile, configure, and install. Final Dish (Output): The resulting package or resource. A Nix derivation encapsulates all this information, telling Nix what inputs to use, how to build it, and what the final output should be."><link rel=stylesheet href=/css/root.min.0e732b812b9751962e01a7c4798a1211cd5f8ac8abec7f99793fe306989e459f.css integrity="sha256-DnMrgSuXUZYuAafEeYoSEc1fisir7H+ZeT/jBpieRZ8=" crossorigin=anonymous><link rel=stylesheet href=/css/bundle.min.e139b0e3b3aff8f0e8e0272554b671a06c857a42278b36c539d96c69ddee2ca2.css integrity="sha256-4Tmw47Ov+PDo4CclVLZxoGyFekInizbFOdlsad3uLKI=" crossorigin=anonymous><script src=/js/bundle.995e4ec99401021e081ec256bee66154ef7f4e5136809432513b2e6d014b4b1d.js integrity="sha256-mV5OyZQBAh4IHsJWvuZhVO9/TlE2gJQyUTsubQFLSx0=" crossorigin=anonymous></script><script defer src=/js/search/flexsearch.compact.64594b125f7b78bdf4fa8316955922bbebb1cd6baef3f16654bfca20309f18f8.js integrity="sha256-ZFlLEl97eL30+oMWlVkiu+uxzWuu8/FmVL/KIDCfGPg="></script><script defer src=/js/search/search.1d980f84df11f3eb7c8c5f17f541d49a0611608df179dd74fa7f06225eb56ace.js integrity="sha256-HZgPhN8R8+t8jF8X9UHUmgYRYI3xed10+n8GIl61as4="></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel=stylesheet></head><body class=notransition><div id=container><header id=main-header><div role=navigation aria-label=Main><div class=nav-left><a href=https://TSawyer87.github.io/ style=color:inherit>NixOS Blog</a></div><div class=nav-right><div style=position:absolute;width:0;height:0><div id=nav-dropdown-menu class=hidden href=#><div class=nav-item><a aria-current=true class=ancestor href=/posts/>Posts</a></div></div></div><a href=https://TSawyer87.github.io//index.xml><img src=/images/rss.png alt="RSS Feed" width=24>
</a><a id=nav-dropdown-button href=#><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4 6H20M4 12H20M4 18H20" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></a><div id=nav-menu><div class=nav-item><a aria-current=true class=ancestor href=/posts/>Posts</a></div></div><a id=theme-switcher href=#><svg class="light-icon" viewBox="0 0 24 24" fill="none"><path d="M12 3V4m0 16v1M4 12H3M6.31412 6.31412 5.5 5.5m12.1859.81412L18.5 5.5M6.31412 17.69 5.5 18.5001M17.6859 17.69 18.5 18.5001M21 12H20m-4 0c0 2.2091-1.7909 4-4 4-2.20914.0-4-1.7909-4-4 0-2.20914 1.79086-4 4-4 2.2091.0 4 1.79086 4 4z" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="dark-icon" viewBox="0 0 24 24" fill="none"><path d="M3.32031 11.6835c0 4.9706 4.02944 9 8.99999 9 3.7872.0 7.028-2.3392 8.3565-5.6515C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834c-4.9706.0-8.99999-4.0294-8.99999-8.99998C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996 5.65605 4.66028 3.32031 7.89912 3.32031 11.6835z" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></a></div></div></header><div class="flex grow"><div id=main-pane><main id=main-content><div class=single-header><ol class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=https://TSawyer87.github.io/><span itemprop=name>Home</span>
</a><meta itemprop=position content='1'></li><span>&nbsp»&nbsp</span><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=https://TSawyer87.github.io/posts/><span itemprop=name>Posts</span>
</a><meta itemprop=position content='2'></li><span>&nbsp»&nbsp</span></ol><h1>Derivations_explained</h1><time class=dim datetime=2025-05-14T19:25:48-04:00>May 14, 2025</time></div><section class=page-section><h1 id=introduction-to-nix-derivations>Introduction to Nix Derivations</h1><figure><img src=/images/gruv10.png alt=gruv10 width=1000></figure><ul><li><p>A derivation in Nix is a fundamental concept that describes how to build a piece of software or a resource (e.g., a package, library, or configuration file). Think of it as a recipe for creating something within the Nix ecosystem.</p></li><li><p>For beginners, the analogy of a cooking recipe is helpful:</p><ul><li><strong>Ingredients (Dependencies):</strong> What other software or libraries are needed.</li><li><strong>Steps (Build Instructions):</strong> The commands to compile, configure, and install.</li><li><strong>Final Dish (Output):</strong> The resulting package or resource.</li></ul></li><li><p>A Nix derivation encapsulates all this information, telling Nix what inputs
to use, how to build it, and what the final output should be.</p></li></ul><h2 id=creating-derivations-in-nix>Creating Derivations in Nix</h2><ul><li><p>The primary way to define packages in Nix is through the <code>mkDerivation</code> function, which is part of the standard environment (<code>stdenv</code>). While a
lower-level <code>derivation</code> function exists for advanced use cases,
<code>mkDerivation</code> simplifies the process by automatically managing dependencies
and the build environment.</p></li><li><p><code>mkDerivation</code> (and <code>derivation</code>) takes a set of attributes as its argument.
At a minimum, you&rsquo;ll often encounter these essential attributes:</p><ol><li><strong>name:</strong> A human-readable identifier for the derivation
(e.g., &ldquo;foo&rdquo;, &ldquo;hello.txt&rdquo;). This helps you and Nix refer to the package.</li><li><strong>system:</strong> Specifies the target architecture for the build
(e.g., <code>builtins.currentSystem</code> for your current machine).</li><li><strong>builder:</strong> Defines the program that will execute the build instructions
(e.g., <code>bash</code>).</li></ol></li></ul><h2 id=our-first-simple-derivation-understanding-the-builder>Our First Simple Derivation: Understanding the Builder</h2><ul><li>To understand how derivations work, let&rsquo;s create a very basic example using a
bash script as our <code>builder</code>.</li></ul><h3 id=why-a-builder-script>Why a Builder Script?</h3><ul><li>The <code>builder</code> attribute in a derivation tells Nix <em>how</em> to perform the build
steps. A simple and common way to define these steps is with a bash script.</li></ul><h3 id=the-challenge-with-shebangs-in-nix>The Challenge with Shebangs in Nix</h3><ul><li><p>In typical Unix-like systems, you might start a bash script with a shebang
(<code>#!/bin/bash</code> or <code>#!/usr/bin/env bash</code>) to tell the system how to execute it.
However, in Nix derivations, we generally avoid this.</p></li><li><p><strong>Reason:</strong> Nix builds happen in an isolated environment where the exact path
to common tools like <code>bash</code> isn&rsquo;t known beforehand (it resides within the Nix
store). Hardcoding a path or relying on the system&rsquo;s <code>PATH</code> would break Nix&rsquo;s
stateless property.</p></li></ul><h3 id=the-importance-of-statelessness-in-nix>The Importance of Statelessness in Nix</h3><ul><li><p><strong>Stateful Systems (Traditional):</strong> When you install software traditionally,
it often modifies the core system environment directly. This can lead to
dependency conflicts and makes rollbacks difficult.</p></li><li><p><strong>Stateless Systems (Nix):</strong> Nix takes a different approach. When installing
a package, it creates a unique, immutable directory in the Nix store. This
means:</p><ul><li><strong>No Conflicts:</strong> Different versions of the same package can coexist
without interfering with each other.</li><li><strong>Reliable Rollback:</strong> You can easily switch back to previous versions
without affecting system-wide files.</li><li><strong>Reproducibility:</strong> Builds are more likely to produce the same result
across different machines if they are &ldquo;pure&rdquo; (don&rsquo;t rely on external
system state).</li></ul></li></ul><h4 id=our-builder-script>Our builder Script</h4><ul><li>For our first derivation, we&rsquo;ll create a simple <code>builder.sh</code> file in the current directory:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># builder.sh</span>
</span></span><span style=display:flex><span>declare -xp
</span></span><span style=display:flex><span>echo foo &gt; $out
</span></span></code></pre></div><ul><li><p>The command <code>declare -xp</code> lists exported variables (it&rsquo;s a bash builtin
function).</p></li><li><p>Nix needs to know where the final built product (the &ldquo;cake&rdquo; in our earlier
analogy) should be placed. So, during the derivation process, Nix calculates
a unique output path within the Nix store. This path is then made available
to our builder script as an environment variable named <code>$out</code>. The <code>.drv</code>
file, which is the recipe, contains instructions for the builder, including
setting up this <code>$out</code> variable. Our builder script will then put the result
of its work (in this case, the &ldquo;foo&rdquo; file) into this specific <code>$out</code> directory.</p></li><li><p>As mentioned earlier we need to find the nix store path to the bash
executable, common way to do this is to load Nixpkgs into the repl
and check:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-repl&gt; :l &lt;nixpkgs&gt;
</span></span><span style=display:flex><span>Added <span style=color:#ae81ff>3950</span> variables.
</span></span><span style=display:flex><span>nix-repl&gt; <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>bash<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;/nix/store/ihmkc7z2wqk3bbipfnlh0yjrlfkkgnv6-bash-4.2-p45&#34;</span>
</span></span></code></pre></div><p>So, with this little trick we are able to refer to <code>bin/bash</code> and create
our derivation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-repl&gt; d <span style=color:#f92672>=</span> derivation <span style=color:#f92672>{</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;foo&#34;</span>; builder <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>bash<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/bash&#34;</span>;
</span></span><span style=display:flex><span> args <span style=color:#f92672>=</span> <span style=color:#f92672>[</span> ./builder.sh <span style=color:#f92672>]</span>; system <span style=color:#f92672>=</span> builtins.currentSystem; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>nix-repl&gt; :b d
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#ae81ff>1</span> built, 0.0 MiB DL<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>this derivation produced the following outputs:
</span></span><span style=display:flex><span>  out -&gt; /nix/store/gczb4qrag22harvv693wwnflqy7lx5pb-foo
</span></span></code></pre></div><ul><li><p>Boom! The contents of <code>/nix/store/w024zci0x1hh1wj6gjq0jagkc1sgrf5r-foo</code>
is really foo! We&rsquo;ve built our first derivation.</p></li><li><p>Derivations are the primitive that Nix uses to define packages. “Package”
is a loosely defined term, but a derivation is simply the result of calling
<code>builtins.derivation</code>.</p></li></ul><h4 id=our-second-derivation>Our Second Derivation</h4><p>The following is a simple <code>hello-drv</code> derivation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>nix-repl<span style=color:#f92672>&gt;</span> hello-drv <span style=color:#f92672>=</span> nixpkgs<span style=color:#f92672>.</span>stdenv<span style=color:#f92672>.</span>mkDerivation {
</span></span><span style=display:flex><span>            name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;hello.txt&#34;</span>;
</span></span><span style=display:flex><span>            unpackPhase <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;true&#34;</span>;
</span></span><span style=display:flex><span>            installPhase <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              echo -n &#34;Hello World!&#34; &gt; $out
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#39;&#39;</span>;
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>nix-repl<span style=color:#f92672>&gt;</span> hello-drv
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>«</span>derivation <span style=color:#e6db74>/nix/store/ad6c51ia15p9arjmvvqkn9fys9sf1kdw-hello.txt.drv</span><span style=color:#960050;background-color:#1e0010>»</span>
</span></span></code></pre></div><ul><li>Derivations have a <code>.drv</code> suffix, as you can see the result of calling
<code>hello-drv</code> is the nix store path to a derivation.</li></ul><h4 id=links-to-articles-about-derivations>Links To Articles about Derivations</h4><ul><li><p><a href=https://nixos.org/guides/nix-pills/06-our-first-derivation>NixPillsOurFirstDerivation</a></p></li><li><p><a href=https://nixos.org/guides/nix-pills/07-working-derivation>NixPills-WorkingDerivation</a></p></li><li><p><a href=https://nix.dev/manual/nix/2.24/language/derivations>nix.dev-Derivations</a></p></li><li><p><a href=https://nix.dev/tutorials/packaging-existing-software>nix.dev-packagingExistingSoftware</a></p></li><li><p><a href=https://ianthehenry.com/posts/how-to-learn-nix/my-first-derivation/>howToLearnNix-MyFirstDerivation</a></p></li><li><p><a href=https://ianthehenry.com/posts/how-to-learn-nix/derivations-in-detail/>howToLearnNix-DerivationsInDetail</a></p></li><li><p><a href=https://www.sam.today/blog/creating-a-super-simple-derivation-learning-nix-pt-3>Sparky/blog-creatingASuperSimpleDerivation</a> # How to learn Nix</p></li><li><p><a href=https://www.sam.today/blog/derivations-102-learning-nix-pt-4>Sparky/blog-Derivations102</a></p></li><li><p><a href=https://scrive.github.io/nix-workshop/04-derivations/01-derivation-basics.html>ScriveNixWorkshop-nixDerivationBasics</a></p></li><li><p><a href=https://zero-to-nix.com/concepts/derivations/>zeroToNix-Derivations</a></p></li><li><p><a href=https://www.tweag.io/blog/2021-02-17-derivation-outputs-and-output-paths/>Tweag-derivationOutputs</a></p></li><li><p><a href=https://ayats.org/blog/nix-tuto-2>theNixLectures-Derivations</a></p></li><li><p><a href=https://bmcgee.ie/posts/2023/02/nix-what-are-fixed-output-derivations-and-why-use-them/>bmcgee-whatAreFixed-OutputDerivations</a></p></li></ul></section></main><footer id=main-footer><div class=footer><a href=#>Scroll to Top</a><div class=footer-copyright><div class=dim>© 2025</div><div>Made with ❤️ and powered by <a href=https://github.com/math-queiroz/rusty-typewriter target=_blank>Rusty Typewriter</a> theme for <a href=https://gohugo.io/ target=_blank>Hugo</a></div></div></div></footer></div><aside id=side-pane class=side-sticky><div class=side-details><span>798 words</span>
<span>6 - 8 minutes read</span></div><h3>Table Of Contents</h3><nav id=TableOfContents><ul><li><a href=#creating-derivations-in-nix>Creating Derivations in Nix</a></li><li><a href=#our-first-simple-derivation-understanding-the-builder>Our First Simple Derivation: Understanding the Builder</a><ul><li><a href=#why-a-builder-script>Why a Builder Script?</a></li><li><a href=#the-challenge-with-shebangs-in-nix>The Challenge with Shebangs in Nix</a></li><li><a href=#the-importance-of-statelessness-in-nix>The Importance of Statelessness in Nix</a></li></ul></li></ul></nav></aside></div></div></body></html>