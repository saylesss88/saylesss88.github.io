<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Comparing_flakes_to_traditional_nix | NixOS Blog</title>
<link rel=icon href=favicon.svg sizes=any type=image/svg+xml><meta property="og:url" content="https://saylesss88.github.io/posts/comparing_flakes_to_traditional_nix/"><meta property="og:site_name" content="NixOS Blog"><meta property="og:title" content="Comparing_flakes_to_traditional_nix"><meta property="og:description" content="Introduction: Flakes and Traditional Nix This post is based on notes from Nix-Hour #4, comparing Traditional Nix and Flakes, focusing on achieving pure build results. See the YouTube video for the original content. This guide adapts the information for clarity and ease of understanding. What is Purity in Nix? A key benefit of Nix Flakes is their default enforcement of pure evaluation.
In Nix, an impure operation depends on something outside its explicit inputs. Examples include:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-14T19:27:18-04:00"><meta property="article:modified_time" content="2025-05-14T19:27:18-04:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Comparing_flakes_to_traditional_nix"><meta name=twitter:description content="Introduction: Flakes and Traditional Nix This post is based on notes from Nix-Hour #4, comparing Traditional Nix and Flakes, focusing on achieving pure build results. See the YouTube video for the original content. This guide adapts the information for clarity and ease of understanding. What is Purity in Nix? A key benefit of Nix Flakes is their default enforcement of pure evaluation.
In Nix, an impure operation depends on something outside its explicit inputs. Examples include:"><link rel=stylesheet href=/css/root.min.0e732b812b9751962e01a7c4798a1211cd5f8ac8abec7f99793fe306989e459f.css integrity="sha256-DnMrgSuXUZYuAafEeYoSEc1fisir7H+ZeT/jBpieRZ8=" crossorigin=anonymous><link rel=stylesheet href=/css/bundle.min.e139b0e3b3aff8f0e8e0272554b671a06c857a42278b36c539d96c69ddee2ca2.css integrity="sha256-4Tmw47Ov+PDo4CclVLZxoGyFekInizbFOdlsad3uLKI=" crossorigin=anonymous><script src=/js/bundle.995e4ec99401021e081ec256bee66154ef7f4e5136809432513b2e6d014b4b1d.js integrity="sha256-mV5OyZQBAh4IHsJWvuZhVO9/TlE2gJQyUTsubQFLSx0=" crossorigin=anonymous></script><script defer src=/js/search/flexsearch.compact.64594b125f7b78bdf4fa8316955922bbebb1cd6baef3f16654bfca20309f18f8.js integrity="sha256-ZFlLEl97eL30+oMWlVkiu+uxzWuu8/FmVL/KIDCfGPg="></script><script defer src=/js/search/search.1d980f84df11f3eb7c8c5f17f541d49a0611608df179dd74fa7f06225eb56ace.js integrity="sha256-HZgPhN8R8+t8jF8X9UHUmgYRYI3xed10+n8GIl61as4="></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel=stylesheet></head><body class=notransition><div id=container><header id=main-header><div role=navigation aria-label=Main><div class=nav-left><a href=https://saylesss88.github.io/ style=color:inherit>NixOS Blog</a></div><div class=nav-right><div style=position:absolute;width:0;height:0><div id=nav-dropdown-menu class=hidden href=#><div class=nav-item><a aria-current=true class=ancestor href=/posts/>Posts</a></div></div></div><a href=https://saylesss88.github.io//index.xml><img src=/images/rss.png alt="RSS Feed" width=24>
</a><a id=nav-dropdown-button href=#><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4 6H20M4 12H20M4 18H20" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></a><div id=nav-menu><div class=nav-item><a aria-current=true class=ancestor href=/posts/>Posts</a></div></div><a id=theme-switcher href=#><svg class="light-icon" viewBox="0 0 24 24" fill="none"><path d="M12 3V4m0 16v1M4 12H3M6.31412 6.31412 5.5 5.5m12.1859.81412L18.5 5.5M6.31412 17.69 5.5 18.5001M17.6859 17.69 18.5 18.5001M21 12H20m-4 0c0 2.2091-1.7909 4-4 4-2.20914.0-4-1.7909-4-4 0-2.20914 1.79086-4 4-4 2.2091.0 4 1.79086 4 4z" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="dark-icon" viewBox="0 0 24 24" fill="none"><path d="M3.32031 11.6835c0 4.9706 4.02944 9 8.99999 9 3.7872.0 7.028-2.3392 8.3565-5.6515C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834c-4.9706.0-8.99999-4.0294-8.99999-8.99998C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996 5.65605 4.66028 3.32031 7.89912 3.32031 11.6835z" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></a></div></div></header><div class="flex grow"><div id=main-pane><main id=main-content><div class=single-header><ol class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=https://saylesss88.github.io/><span itemprop=name>Home</span>
</a><meta itemprop=position content='1'></li><span>&nbsp»&nbsp</span><li itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemprop=item href=https://saylesss88.github.io/posts/><span itemprop=name>Posts</span>
</a><meta itemprop=position content='2'></li><span>&nbsp»&nbsp</span></ol><h1>Comparing_flakes_to_traditional_nix</h1><time class=dim datetime=2025-05-14T19:27:18-04:00>May 14, 2025</time></div><section class=page-section><h1 id=introduction-flakes-and-traditional-nix>Introduction: Flakes and Traditional Nix</h1><figure><img src=/images/nixWinter.png alt="nix winter" width=1000></figure><ul><li>This post is based on notes from Nix-Hour #4, comparing Traditional Nix and Flakes, focusing on achieving pure build results. See the <a href="https://www.youtube.com/watch?v=atmoYyBAhF4">YouTube video</a> for the original content. This guide adapts the information for clarity and ease of understanding.</li></ul><h2 id=what-is-purity-in-nix>What is Purity in Nix?</h2><ul><li><p>A key benefit of Nix Flakes is their <em>default</em> enforcement of <strong>pure evaluation</strong>.</p></li><li><p>In Nix, an <strong>impure operation</strong> depends on something <em>outside</em> its explicit inputs. Examples include:</p><ul><li>User&rsquo;s system configuration</li><li>Environment variables</li><li>Current time</li></ul></li><li><p>Impurity leads to unpredictable builds that may differ across systems or time.</p></li></ul><h2 id=building-a-simple-hello-package-flakes-vs-traditional-nix>Building a Simple &ldquo;hello&rdquo; Package: Flakes vs. Traditional Nix</h2><ul><li>We&rsquo;ll demonstrate building a basic &ldquo;hello&rdquo; package using both Flakes and Traditional Nix to highlight the differences in handling purity.</li></ul><h2 id=using-nix-flakes>Using Nix Flakes</h2><ol><li><p><strong>Setup:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir hello <span style=color:#f92672>&amp;&amp;</span> cd hello/
</span></span></code></pre></div></li><li><p><strong>Create <code>flake.nix</code> (Initial Impure Example):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># flake.nix</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  outputs <span style=color:#f92672>=</span> { self<span style=color:#f92672>,</span> nixpkgs }: {
</span></span><span style=display:flex><span>    myHello <span style=color:#f92672>=</span> (<span style=color:#f92672>import</span> nixpkgs {})<span style=color:#f92672>.</span>hello;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>Note: Flakes don&rsquo;t have access to <code>builtins.currentSystem</code> directly.</li></ul></li><li><p><strong>Impure Build (Fails):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix build .#myHello
</span></span></code></pre></div><ul><li>This fails because Flakes enforce purity by default.</li></ul></li><li><p><strong>Force Impure Build:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix build .#myHello --impure
</span></span></code></pre></div></li><li><p><strong>Making the Flake Pure:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># flake.nix</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  inputs <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    nixpkgs<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:NixOS/nixpkgs&#34;</span>;
</span></span><span style=display:flex><span>    flake-utils<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:numtide/flake-utils&#34;</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  outputs <span style=color:#f92672>=</span> { self<span style=color:#f92672>,</span> nixpkgs<span style=color:#f92672>,</span> flake-utils }:
</span></span><span style=display:flex><span>    flake-utils<span style=color:#f92672>.</span>lib<span style=color:#f92672>.</span>eachDefaultSystem (system:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span>
</span></span><span style=display:flex><span>        pkgs <span style=color:#f92672>=</span> nixpkgs<span style=color:#f92672>.</span>legacyPackages<span style=color:#f92672>.</span><span style=color:#e6db74>${</span>system<span style=color:#e6db74>}</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>in</span> {
</span></span><span style=display:flex><span>        packages<span style=color:#f92672>.</span>myHello <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>hello;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><code>flake-utils</code> simplifies making flakes system-agnostic and provides the <code>system</code> attribute.</li></ul></li><li><p><strong>Pure Build (Success):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix build .#myHello
</span></span></code></pre></div></li></ol><h2 id=using-traditional-nix>Using Traditional Nix</h2><ol><li><p><strong>Setup:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir hello2 <span style=color:#f92672>&amp;&amp;</span> cd hello2/
</span></span></code></pre></div></li><li><p><strong>Create <code>default.nix</code> (Initial Impure Example):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># default.nix</span>
</span></span><span style=display:flex><span>{ myHello <span style=color:#f92672>=</span> (<span style=color:#f92672>import</span> <span style=color:#e6db74>&lt;nixpkgs&gt;</span> { })<span style=color:#f92672>.</span>hello; }
</span></span></code></pre></div></li><li><p><strong>Build (Impure):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build -A myHello
</span></span></code></pre></div></li><li><p><strong>Impurity Explained:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix repl
</span></span><span style=display:flex><span>nix-repl&gt; &lt;nixpkgs&gt;
</span></span><span style=display:flex><span>/nix/var/nix/profiles/per-user/root/channels/nixos
</span></span></code></pre></div><ul><li><code>&lt;nixpkgs></code> depends on the user&rsquo;s environment (Nixpkgs channel), making it impure. Even with channels disabled, it relies on a specific Nixpkgs version in the store.</li></ul></li><li><p><strong>Achieving Purity: Using <code>fetchTarball</code></strong></p><ul><li><p>GitHub allows downloading repository snapshots at specific commits, crucial for reproducibility.</p></li><li><p><strong>Get Nixpkgs Revision from <code>flake.lock</code> (from the Flake example):</strong></p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># flake.lock</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;nixpkgs&#34;</span>: {
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;locked&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;lastModified&#34;</span>: <span style=color:#ae81ff>1746372124</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;narHash&#34;</span>: <span style=color:#e6db74>&#34;sha256-n7W8Y6bL7mgHYW1vkXKi9zi/sV4UZqcBovICQu0rdNU=&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;owner&#34;</span>: <span style=color:#e6db74>&#34;NixOS&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;repo&#34;</span>: <span style=color:#e6db74>&#34;nixpkgs&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;rev&#34;</span>: <span style=color:#e6db74>&#34;f5cbfa4dbbe026c155cf5a9204f3e9121d3a5fe0&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;github&#34;</span>
</span></span><span style=display:flex><span>  }<span style=color:#f92672>,</span>
</span></span></code></pre></div></li><li><p><strong>Modify <code>default.nix</code> for Purity:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># default.nix</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span>
</span></span><span style=display:flex><span>  nixpkgs <span style=color:#f92672>=</span> fetchTarball {
</span></span><span style=display:flex><span>    url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;[https://github.com/NixOS/nixpkgs/archive/f5cbfa4dbbe026c155cf5a9204f3e9121d3a5fe0.tar.gz](https://github.com/NixOS/nixpkgs/archive/f5cbfa4dbbe026c155cf5a9204f3e9121d3a5fe0.tar.gz)&#34;</span>;
</span></span><span style=display:flex><span>    sha256 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0000000000000000000000000000000000000000000000000000&#34;</span>; <span style=color:#75715e># Placeholder</span>
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span><span style=color:#66d9ef>in</span> {
</span></span><span style=display:flex><span>  myHello <span style=color:#f92672>=</span> (<span style=color:#f92672>import</span> nixpkgs {})<span style=color:#f92672>.</span>hello;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>Replace <code>&lt;nixpkgs></code> with <code>fetchTarball</code> and a specific revision. A placeholder <code>sha256</code> is used initially.</li></ul></li><li><p><strong>Build (Nix provides the correct <code>sha256</code>):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build -A myHello
</span></span></code></pre></div></li><li><p><strong>Verification:</strong> Both Flake and Traditional Nix builds now produce the same output path.</p></li><li><p><strong>Remaining Impurities in Traditional Nix:</strong></p><ul><li>Default arguments to <code>import &lt;nixpkgs> {}</code> can introduce impurity:<ul><li><code>overlays</code>: <code>~/.config/nixpkgs/overlays</code> (user-specific)</li><li><code>config</code>: <code>~/.config/nixpkgs/config.nix</code> (user-specific)</li><li><code>system</code>: <code>builtins.currentSystem</code> (machine-specific)</li></ul></li></ul></li><li><p><strong>Making Traditional Nix Fully Pure:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># default.nix</span>
</span></span><span style=display:flex><span>{system <span style=color:#f92672>?</span> builtins<span style=color:#f92672>.</span>currentSystem}:
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span>
</span></span><span style=display:flex><span>  nixpkgs <span style=color:#f92672>=</span> fetchTarball {
</span></span><span style=display:flex><span>    url <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;[https://github.com/NixOS/nixpkgs/archive/0243fb86a6f43e506b24b4c0533bd0b0de211c19.tar.gz](https://github.com/NixOS/nixpkgs/archive/0243fb86a6f43e506b24b4c0533bd0b0de211c19.tar.gz)&#34;</span>;
</span></span><span style=display:flex><span>    sha256 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;1qvdbvdza7hsqhra0yg7xs252pr1q70nyrsdj6570qv66vq0fjnh&#34;</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span><span style=color:#66d9ef>in</span> {
</span></span><span style=display:flex><span>  myHello <span style=color:#f92672>=</span> (<span style=color:#f92672>import</span> nixpkgs {
</span></span><span style=display:flex><span>    overlays <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    config <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>inherit</span> system;
</span></span><span style=display:flex><span>  })<span style=color:#f92672>.</span>hello;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>Override impure defaults for <code>overlays</code>, <code>config</code>, and make <code>system</code> an argument.</li></ul></li><li><p><strong>Building with a Specific System:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build -A myHello --argstr system x86_64-linux
</span></span></code></pre></div></li><li><p><strong>Pure Evaluation Mode in Traditional Nix:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-instantiate --eval --pure-eval --expr <span style=color:#e6db74>&#39;fetchGit { url = ./.; rev = &#34;b4fe677e255c6f89c9a6fdd3ddd9319b0982b1ad&#34;; }&#39;</span>
</span></span></code></pre></div><ul><li>Example of using <code>--pure-eval</code>.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build --pure-eval --expr <span style=color:#e6db74>&#39;(import (fetchGit { url = ./.; rev = &#34;b4fe677e255c6f89c9a6fdd3ddd9319b0982b1ad&#34;; }) { system = &#34;x86_64-linux&#34;; }).myHello&#39;</span>
</span></span></code></pre></div><ul><li>Building with a specific revision and system.</li></ul></li></ol><h3 id=updating-nixpkgs>Updating Nixpkgs</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix flake update
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>nix build <span style=color:#f92672>.</span><span style=color:#75715e>#myHello --override-input nixpkgs github:NixOS/nixpkgs/nixos-24.11</span>
</span></span></code></pre></div><h3 id=updating-traditional-nix-using-niv>Updating Traditional Nix (using <code>niv</code>)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>nix-shell <span style=color:#960050;background-color:#1e0010>-</span>p niv
</span></span><span style=display:flex><span>niv init
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># default.nix</span>
</span></span><span style=display:flex><span>{ system <span style=color:#f92672>?</span> builtins<span style=color:#f92672>.</span>currentSystem<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  sources <span style=color:#f92672>?</span> <span style=color:#f92672>import</span> <span style=color:#e6db74>nix/sources.nix</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  nixpkgs <span style=color:#f92672>?</span> sources<span style=color:#f92672>.</span>nixpkgs<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  pkgs <span style=color:#f92672>?</span> <span style=color:#f92672>import</span> nixpkgs {
</span></span><span style=display:flex><span>    overlays <span style=color:#f92672>=</span> [ ];
</span></span><span style=display:flex><span>    config <span style=color:#f92672>=</span> { };
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>inherit</span> system;
</span></span><span style=display:flex><span>  }<span style=color:#f92672>,</span> }: {
</span></span><span style=display:flex><span>  myHello <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>hello;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And build it with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build -A myHello
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>niv update nixpkgs --branch<span style=color:#f92672>=</span>nixos-unstable
</span></span><span style=display:flex><span>nix-build -A myHello
</span></span></code></pre></div><h4 id=adding-home-manager-with-flakes>Adding Home-Manager with Flakes</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># flake.nix</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  inputs <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    nixpkgs<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:NixOS/nixpkgs&#34;</span>;
</span></span><span style=display:flex><span>    flake-utils<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:numtide/flake-utils&#34;</span>;
</span></span><span style=display:flex><span>    home-manager<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:nix-community/home-manager&#34;</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  outputs <span style=color:#f92672>=</span> { self<span style=color:#f92672>,</span> nixpkgs<span style=color:#f92672>,</span> flake-utils<span style=color:#f92672>,</span> home-manager<span style=color:#f92672>,</span> <span style=color:#f92672>...</span> }:
</span></span><span style=display:flex><span>    flake-utils<span style=color:#f92672>.</span>lib<span style=color:#f92672>.</span>eachDefaultSystem (system:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> pkgs <span style=color:#f92672>=</span> nixpkgs<span style=color:#f92672>.</span>legacyPackages<span style=color:#f92672>.</span><span style=color:#e6db74>${</span>system<span style=color:#e6db74>}</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>in</span> {
</span></span><span style=display:flex><span>        packages<span style=color:#f92672>.</span>myHello <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>hello;
</span></span><span style=display:flex><span>        packages<span style=color:#f92672>.</span>x86_64-linux<span style=color:#f92672>.</span>homeManagerDocs <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>          home-manager<span style=color:#f92672>.</span>packages<span style=color:#f92672>.</span>x86_64-linux<span style=color:#f92672>.</span>docs-html;
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix flake update
</span></span><span style=display:flex><span>nix flake show github:nix-community/home-manager
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>home-manager<span style=color:#f92672>.</span>inputs<span style=color:#f92672>.</span>follows <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;nixpkgs&#34;</span>;
</span></span></code></pre></div><h4 id=adding-home-manager-with-traditional-nix>Adding Home-Manager with Traditional Nix</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>niv add <span style=color:#e6db74>nix-community/home-manager</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>nix repl
</span></span><span style=display:flex><span>nix-repl<span style=color:#f92672>&gt;</span> s <span style=color:#f92672>=</span> <span style=color:#f92672>import</span> <span style=color:#e6db74>./nix/sources.nix</span>
</span></span><span style=display:flex><span>nix-repl<span style=color:#f92672>&gt;</span> s<span style=color:#f92672>.</span>home-manager
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{ system <span style=color:#f92672>?</span> builtins<span style=color:#f92672>.</span>currentSystem<span style=color:#f92672>,</span> sources <span style=color:#f92672>?</span> <span style=color:#f92672>import</span> <span style=color:#e6db74>nix/sources.nix</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>,</span> nixpkgs <span style=color:#f92672>?</span> sources<span style=color:#f92672>.</span>nixpkgs<span style=color:#f92672>,</span> pkgs <span style=color:#f92672>?</span> <span style=color:#f92672>import</span> nixpkgs {
</span></span><span style=display:flex><span>    overlays <span style=color:#f92672>=</span> [ ];
</span></span><span style=display:flex><span>    config <span style=color:#f92672>=</span> { };
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>inherit</span> system;
</span></span><span style=display:flex><span>  }<span style=color:#f92672>,</span> }: {
</span></span><span style=display:flex><span>  homeManagerDocs <span style=color:#f92672>=</span> (<span style=color:#f92672>import</span> sources<span style=color:#f92672>.</span>home-manager { pkgs <span style=color:#f92672>=</span> pkgs; })<span style=color:#f92672>.</span>docs;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  myHello <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>hello;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build -A homeManagerDocs
</span></span></code></pre></div></section></main><footer id=main-footer><div class=footer><a href=#>Scroll to Top</a><div class=footer-copyright><div class=dim>© 2025</div><div>Made with ❤️ and powered by <a href=https://github.com/math-queiroz/rusty-typewriter target=_blank>Rusty Typewriter</a> theme for <a href=https://gohugo.io/ target=_blank>Hugo</a></div></div></div></footer></div><aside id=side-pane class=side-sticky><div class=side-details><span>726 words</span>
<span>6 - 8 minutes read</span></div><h3>Table Of Contents</h3><nav id=TableOfContents><ul><li><a href=#what-is-purity-in-nix>What is Purity in Nix?</a></li><li><a href=#building-a-simple-hello-package-flakes-vs-traditional-nix>Building a Simple &ldquo;hello&rdquo; Package: Flakes vs. Traditional Nix</a></li><li><a href=#using-nix-flakes>Using Nix Flakes</a></li><li><a href=#using-traditional-nix>Using Traditional Nix</a><ul><li><a href=#updating-nixpkgs>Updating Nixpkgs</a></li><li><a href=#updating-traditional-nix-using-niv>Updating Traditional Nix (using <code>niv</code>)</a></li></ul></li></ul></nav></aside></div></div></body></html>