<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://saylesss88.github.io/favicon.ico><meta property="og:url" content="https://saylesss88.github.io/posts/comparing_flakes_to_traditional_nix/"><meta property="og:site_name" content="NixOS Blog"><meta property="og:title" content="Comparing_flakes_to_traditional_nix"><meta property="og:description" content="Introduction: Flakes and Traditional Nix TOC
Introduction: Flakes and Traditional Nix
What is Purity in Nix? Building a Simple “hello” Package: Flakes vs. Traditional Nix Using Nix Flakes Using Traditional Nix - Updating Nixpkgs - Updating Traditional Nix (using niv) - Adding Home-Manager with Flakes - Adding Home-Manager with Traditional Nix This post is based on notes from Nix-Hour #4, comparing Traditional Nix and Flakes, focusing on achieving pure build results. See the YouTube video for the original content. This guide adapts the information for clarity and ease of understanding. What is Purity in Nix? A key benefit of Nix Flakes is their default enforcement of pure evaluation."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-14T19:27:18-04:00"><meta property="article:modified_time" content="2025-05-14T19:27:18-04:00"><title>NixOS Blog | Comparing_flakes_to_traditional_nix</title>
<link rel=stylesheet href=/css/main.min.9d7861a670d885bddfdca28e2bec973020e2e1f1b049a5849a85a2e0fa249e4c.css integrity="sha256-nXhhpnDYhb3f3KKOK+yXMCDi4fGwSaWEmoWi4Poknkw=" crossorigin=anonymous><link rel=stylesheet href=/css/palette/default.min.cfcbb0f894da76afbc5a46072e5cbec733a983f27395920a3cfdf6977053c351.css integrity="sha256-z8uw+JTadq+8WkYHLly+xzOpg/JzlZIKPP32l3BTw1E=" crossorigin=anonymous><script src=/js/main.86bb3d8e6f46df0fc97c2731e6b99175a13b87a4086acf578ff9b6992fcf32c1.js integrity="sha256-hrs9jm9G3w/JfCcx5rmRdaE7h6QIas9Xj/m2mS/PMsE=" crossorigin=anonymous></script><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH crossorigin=anonymous></head><body class=dark><main><div class="container pt-5"><div class="row mt-5 pt-5"></div><div class=post><header class=mb-4><h1 class=text-uppercase>Comparing_flakes_to_traditional_nix</h1><div aria-label=breadcrumb><ol class=breadcrumb><li class="breadcrumb-item small"><time datetime=2025-05-14T19:27:18-04:00>May 14, 2025</time></li><li class="breadcrumb-item small">4 minutes</li></ol></div></header><article><h1 id=introduction-flakes-and-traditional-nix>Introduction: Flakes and Traditional Nix</h1><p><strong>TOC</strong></p><ul><li><p><a href=#introduction-flakes-and-traditional-nix>Introduction: Flakes and Traditional Nix</a></p><ul><li><a href=#what-is-purity-in-nix>What is Purity in Nix?</a></li><li><a href=#building-a-simple-hello-package-flakes-vs-traditional-nix>Building a Simple &ldquo;hello&rdquo; Package: Flakes vs. Traditional Nix</a></li><li><a href=#using-nix-flakes>Using Nix Flakes</a></li><li><a href=#using-traditional-nix>Using Traditional Nix</a> - <a href=#updating-nixpkgs>Updating Nixpkgs</a> - <a href=#updating-traditional-nix-using-niv>Updating Traditional Nix (using <code>niv</code>)</a> - <a href=#adding-home-manager-with-flakes>Adding Home-Manager with Flakes</a> - <a href=#adding-home-manager-with-traditional-nix>Adding Home-Manager with Traditional Nix</a></li></ul></li></ul><figure><img src=/images/nixWinter.png alt="nix winter" width=700></figure><ul><li>This post is based on notes from Nix-Hour #4, comparing Traditional Nix and Flakes, focusing on achieving pure build results. See the <a href="https://www.youtube.com/watch?v=atmoYyBAhF4">YouTube video</a> for the original content. This guide adapts the information for clarity and ease of understanding.</li></ul><h2 id=what-is-purity-in-nix>What is Purity in Nix?</h2><ul><li><p>A key benefit of Nix Flakes is their <em>default</em> enforcement of <strong>pure evaluation</strong>.</p></li><li><p>In Nix, an <strong>impure operation</strong> depends on something <em>outside</em> its explicit inputs. Examples include:</p><ul><li>User&rsquo;s system configuration</li><li>Environment variables</li><li>Current time</li></ul></li><li><p>Impurity leads to unpredictable builds that may differ across systems or time.</p></li></ul><h2 id=building-a-simple-hello-package-flakes-vs-traditional-nix>Building a Simple &ldquo;hello&rdquo; Package: Flakes vs. Traditional Nix</h2><ul><li>We&rsquo;ll demonstrate building a basic &ldquo;hello&rdquo; package using both Flakes and Traditional Nix to highlight the differences in handling purity.</li></ul><h2 id=using-nix-flakes>Using Nix Flakes</h2><ol><li><p><strong>Setup:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir hello <span style=color:#f92672>&amp;&amp;</span> cd hello/
</span></span></code></pre></div></li><li><p><strong>Create <code>flake.nix</code> (Initial Impure Example):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># flake.nix</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  outputs <span style=color:#f92672>=</span> { self<span style=color:#f92672>,</span> nixpkgs }: {
</span></span><span style=display:flex><span>    myHello <span style=color:#f92672>=</span> (<span style=color:#f92672>import</span> nixpkgs {})<span style=color:#f92672>.</span>hello;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>Note: Flakes don&rsquo;t have access to <code>builtins.currentSystem</code> directly.</li></ul></li><li><p><strong>Impure Build (Fails):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix build .#myHello
</span></span></code></pre></div><ul><li>This fails because Flakes enforce purity by default.</li></ul></li><li><p><strong>Force Impure Build:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix build .#myHello --impure
</span></span></code></pre></div></li><li><p><strong>Making the Flake Pure:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># flake.nix</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  inputs <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    nixpkgs<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:NixOS/nixpkgs&#34;</span>;
</span></span><span style=display:flex><span>    flake-utils<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:numtide/flake-utils&#34;</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  outputs <span style=color:#f92672>=</span> { self<span style=color:#f92672>,</span> nixpkgs<span style=color:#f92672>,</span> flake-utils }:
</span></span><span style=display:flex><span>    flake-utils<span style=color:#f92672>.</span>lib<span style=color:#f92672>.</span>eachDefaultSystem (system:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span>
</span></span><span style=display:flex><span>        pkgs <span style=color:#f92672>=</span> nixpkgs<span style=color:#f92672>.</span>legacyPackages<span style=color:#f92672>.</span><span style=color:#e6db74>${</span>system<span style=color:#e6db74>}</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>in</span> {
</span></span><span style=display:flex><span>        packages<span style=color:#f92672>.</span>myHello <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>hello;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><code>flake-utils</code> simplifies making flakes system-agnostic and provides the <code>system</code> attribute.</li></ul></li><li><p><strong>Pure Build (Success):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix build .#myHello
</span></span></code></pre></div></li></ol><h2 id=using-traditional-nix>Using Traditional Nix</h2><ol><li><p><strong>Setup:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir hello2 <span style=color:#f92672>&amp;&amp;</span> cd hello2/
</span></span></code></pre></div></li><li><p><strong>Create <code>default.nix</code> (Initial Impure Example):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># default.nix</span>
</span></span><span style=display:flex><span>{ myHello <span style=color:#f92672>=</span> (<span style=color:#f92672>import</span> <span style=color:#e6db74>&lt;nixpkgs&gt;</span> { })<span style=color:#f92672>.</span>hello; }
</span></span></code></pre></div></li><li><p><strong>Build (Impure):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build -A myHello
</span></span></code></pre></div></li><li><p><strong>Impurity Explained:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix repl
</span></span><span style=display:flex><span>nix-repl&gt; &lt;nixpkgs&gt;
</span></span><span style=display:flex><span>/nix/var/nix/profiles/per-user/root/channels/nixos
</span></span></code></pre></div><ul><li><code>&lt;nixpkgs></code> depends on the user&rsquo;s environment (Nixpkgs channel), making it impure. Even with channels disabled, it relies on a specific Nixpkgs version in the store.</li></ul></li><li><p><strong>Achieving Purity: Using <code>fetchTarball</code></strong></p><ul><li><p>GitHub allows downloading repository snapshots at specific commits, crucial for reproducibility.</p></li><li><p><strong>Get Nixpkgs Revision from <code>flake.lock</code> (from the Flake example):</strong></p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># flake.lock</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;nixpkgs&#34;</span>: {
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;locked&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;lastModified&#34;</span>: <span style=color:#ae81ff>1746372124</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;narHash&#34;</span>: <span style=color:#e6db74>&#34;sha256-n7W8Y6bL7mgHYW1vkXKi9zi/sV4UZqcBovICQu0rdNU=&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;owner&#34;</span>: <span style=color:#e6db74>&#34;NixOS&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;repo&#34;</span>: <span style=color:#e6db74>&#34;nixpkgs&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;rev&#34;</span>: <span style=color:#e6db74>&#34;f5cbfa4dbbe026c155cf5a9204f3e9121d3a5fe0&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;github&#34;</span>
</span></span><span style=display:flex><span>  }<span style=color:#f92672>,</span>
</span></span></code></pre></div></li><li><p><strong>Modify <code>default.nix</code> for Purity:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># default.nix</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span>
</span></span><span style=display:flex><span>  nixpkgs <span style=color:#f92672>=</span> fetchTarball {
</span></span><span style=display:flex><span>    url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;[https://github.com/NixOS/nixpkgs/archive/f5cbfa4dbbe026c155cf5a9204f3e9121d3a5fe0.tar.gz](https://github.com/NixOS/nixpkgs/archive/f5cbfa4dbbe026c155cf5a9204f3e9121d3a5fe0.tar.gz)&#34;</span>;
</span></span><span style=display:flex><span>    sha256 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0000000000000000000000000000000000000000000000000000&#34;</span>; <span style=color:#75715e># Placeholder</span>
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span><span style=color:#66d9ef>in</span> {
</span></span><span style=display:flex><span>  myHello <span style=color:#f92672>=</span> (<span style=color:#f92672>import</span> nixpkgs {})<span style=color:#f92672>.</span>hello;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>Replace <code>&lt;nixpkgs></code> with <code>fetchTarball</code> and a specific revision. A placeholder <code>sha256</code> is used initially.</li></ul></li><li><p><strong>Build (Nix provides the correct <code>sha256</code>):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build -A myHello
</span></span></code></pre></div></li><li><p><strong>Verification:</strong> Both Flake and Traditional Nix builds now produce the same output path.</p></li><li><p><strong>Remaining Impurities in Traditional Nix:</strong></p><ul><li>Default arguments to <code>import &lt;nixpkgs> {}</code> can introduce impurity:<ul><li><code>overlays</code>: <code>~/.config/nixpkgs/overlays</code> (user-specific)</li><li><code>config</code>: <code>~/.config/nixpkgs/config.nix</code> (user-specific)</li><li><code>system</code>: <code>builtins.currentSystem</code> (machine-specific)</li></ul></li></ul></li><li><p><strong>Making Traditional Nix Fully Pure:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># default.nix</span>
</span></span><span style=display:flex><span>{system <span style=color:#f92672>?</span> builtins<span style=color:#f92672>.</span>currentSystem}:
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span>
</span></span><span style=display:flex><span>  nixpkgs <span style=color:#f92672>=</span> fetchTarball {
</span></span><span style=display:flex><span>    url <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;[https://github.com/NixOS/nixpkgs/archive/0243fb86a6f43e506b24b4c0533bd0b0de211c19.tar.gz](https://github.com/NixOS/nixpkgs/archive/0243fb86a6f43e506b24b4c0533bd0b0de211c19.tar.gz)&#34;</span>;
</span></span><span style=display:flex><span>    sha256 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;1qvdbvdza7hsqhra0yg7xs252pr1q70nyrsdj6570qv66vq0fjnh&#34;</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span><span style=color:#66d9ef>in</span> {
</span></span><span style=display:flex><span>  myHello <span style=color:#f92672>=</span> (<span style=color:#f92672>import</span> nixpkgs {
</span></span><span style=display:flex><span>    overlays <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    config <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>inherit</span> system;
</span></span><span style=display:flex><span>  })<span style=color:#f92672>.</span>hello;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>Override impure defaults for <code>overlays</code>, <code>config</code>, and make <code>system</code> an argument.</li></ul></li><li><p><strong>Building with a Specific System:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build -A myHello --argstr system x86_64-linux
</span></span></code></pre></div></li><li><p><strong>Pure Evaluation Mode in Traditional Nix:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-instantiate --eval --pure-eval --expr <span style=color:#e6db74>&#39;fetchGit { url = ./.; rev = &#34;b4fe677e255c6f89c9a6fdd3ddd9319b0982b1ad&#34;; }&#39;</span>
</span></span></code></pre></div><ul><li>Example of using <code>--pure-eval</code>.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build --pure-eval --expr <span style=color:#e6db74>&#39;(import (fetchGit { url = ./.; rev = &#34;b4fe677e255c6f89c9a6fdd3ddd9319b0982b1ad&#34;; }) { system = &#34;x86_64-linux&#34;; }).myHello&#39;</span>
</span></span></code></pre></div><ul><li>Building with a specific revision and system.</li></ul></li></ol><h3 id=updating-nixpkgs>Updating Nixpkgs</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix flake update
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>nix build <span style=color:#f92672>.</span><span style=color:#75715e>#myHello --override-input nixpkgs github:NixOS/nixpkgs/nixos-24.11</span>
</span></span></code></pre></div><h3 id=updating-traditional-nix-using-niv>Updating Traditional Nix (using <code>niv</code>)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>nix-shell <span style=color:#960050;background-color:#1e0010>-</span>p niv
</span></span><span style=display:flex><span>niv init
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># default.nix</span>
</span></span><span style=display:flex><span>{ system <span style=color:#f92672>?</span> builtins<span style=color:#f92672>.</span>currentSystem<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  sources <span style=color:#f92672>?</span> <span style=color:#f92672>import</span> <span style=color:#e6db74>nix/sources.nix</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  nixpkgs <span style=color:#f92672>?</span> sources<span style=color:#f92672>.</span>nixpkgs<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  pkgs <span style=color:#f92672>?</span> <span style=color:#f92672>import</span> nixpkgs {
</span></span><span style=display:flex><span>    overlays <span style=color:#f92672>=</span> [ ];
</span></span><span style=display:flex><span>    config <span style=color:#f92672>=</span> { };
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>inherit</span> system;
</span></span><span style=display:flex><span>  }<span style=color:#f92672>,</span> }: {
</span></span><span style=display:flex><span>  myHello <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>hello;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And build it with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build -A myHello
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>niv update nixpkgs --branch<span style=color:#f92672>=</span>nixos-unstable
</span></span><span style=display:flex><span>nix-build -A myHello
</span></span></code></pre></div><h4 id=adding-home-manager-with-flakes>Adding Home-Manager with Flakes</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># flake.nix</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  inputs <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    nixpkgs<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:NixOS/nixpkgs&#34;</span>;
</span></span><span style=display:flex><span>    flake-utils<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:numtide/flake-utils&#34;</span>;
</span></span><span style=display:flex><span>    home-manager<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github:nix-community/home-manager&#34;</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  outputs <span style=color:#f92672>=</span> { self<span style=color:#f92672>,</span> nixpkgs<span style=color:#f92672>,</span> flake-utils<span style=color:#f92672>,</span> home-manager<span style=color:#f92672>,</span> <span style=color:#f92672>...</span> }:
</span></span><span style=display:flex><span>    flake-utils<span style=color:#f92672>.</span>lib<span style=color:#f92672>.</span>eachDefaultSystem (system:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> pkgs <span style=color:#f92672>=</span> nixpkgs<span style=color:#f92672>.</span>legacyPackages<span style=color:#f92672>.</span><span style=color:#e6db74>${</span>system<span style=color:#e6db74>}</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>in</span> {
</span></span><span style=display:flex><span>        packages<span style=color:#f92672>.</span>myHello <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>hello;
</span></span><span style=display:flex><span>        packages<span style=color:#f92672>.</span>x86_64-linux<span style=color:#f92672>.</span>homeManagerDocs <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>          home-manager<span style=color:#f92672>.</span>packages<span style=color:#f92672>.</span>x86_64-linux<span style=color:#f92672>.</span>docs-html;
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix flake update
</span></span><span style=display:flex><span>nix flake show github:nix-community/home-manager
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>home-manager<span style=color:#f92672>.</span>inputs<span style=color:#f92672>.</span>follows <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;nixpkgs&#34;</span>;
</span></span></code></pre></div><h4 id=adding-home-manager-with-traditional-nix>Adding Home-Manager with Traditional Nix</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>niv add <span style=color:#e6db74>nix-community/home-manager</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>nix repl
</span></span><span style=display:flex><span>nix-repl<span style=color:#f92672>&gt;</span> s <span style=color:#f92672>=</span> <span style=color:#f92672>import</span> <span style=color:#e6db74>./nix/sources.nix</span>
</span></span><span style=display:flex><span>nix-repl<span style=color:#f92672>&gt;</span> s<span style=color:#f92672>.</span>home-manager
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{ system <span style=color:#f92672>?</span> builtins<span style=color:#f92672>.</span>currentSystem<span style=color:#f92672>,</span> sources <span style=color:#f92672>?</span> <span style=color:#f92672>import</span> <span style=color:#e6db74>nix/sources.nix</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>,</span> nixpkgs <span style=color:#f92672>?</span> sources<span style=color:#f92672>.</span>nixpkgs<span style=color:#f92672>,</span> pkgs <span style=color:#f92672>?</span> <span style=color:#f92672>import</span> nixpkgs {
</span></span><span style=display:flex><span>    overlays <span style=color:#f92672>=</span> [ ];
</span></span><span style=display:flex><span>    config <span style=color:#f92672>=</span> { };
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>inherit</span> system;
</span></span><span style=display:flex><span>  }<span style=color:#f92672>,</span> }: {
</span></span><span style=display:flex><span>  homeManagerDocs <span style=color:#f92672>=</span> (<span style=color:#f92672>import</span> sources<span style=color:#f92672>.</span>home-manager { pkgs <span style=color:#f92672>=</span> pkgs; })<span style=color:#f92672>.</span>docs;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  myHello <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>hello;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build -A homeManagerDocs
</span></span></code></pre></div></article><div class=row><div class=col-md><a href=https://saylesss88.github.io/posts/declarative_depinject/><span>previous: </span><span>Declarative_depinject</span></a></div><div class="col-md text-md-end"><a href=https://saylesss88.github.io/posts/nix_lang_basics/><span>next: </span><span>Nix_lang_basics</span></a></div></div></div></div><footer><div class="container mt-4 pb-1"><p class="small opacity-75"></p></div></footer></main><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js integrity=sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz crossorigin=anonymous></script></body></html>