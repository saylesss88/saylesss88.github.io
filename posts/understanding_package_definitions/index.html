<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://saylesss88.github.io/favicon.ico><meta property="og:url" content="https://saylesss88.github.io/posts/understanding_package_definitions/"><meta property="og:site_name" content="NixOS Blog"><meta property="og:title" content="Understanding_package_definitions"><meta property="og:description" content="Understanding Package Definitions in Nix TOC
Understanding Package Definitions in Nix The Journey from Definition to Package Skeleton of a Derivation Example: A Simple “Hello” Package Definition Swaytools Package Definition Resources In Nix, the concept of a package can refer to two things:
A collection of files and data that constitute a piece of software or an artifact.
A Nix expression that describes how to create such a collection. This expression acts as a blueprint before the package exists in a tangible form."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-14T19:19:10-04:00"><meta property="article:modified_time" content="2025-05-14T19:19:10-04:00"><title>NixOS Blog | Understanding_package_definitions</title>
<link rel=stylesheet href=/css/main.min.9d7861a670d885bddfdca28e2bec973020e2e1f1b049a5849a85a2e0fa249e4c.css integrity="sha256-nXhhpnDYhb3f3KKOK+yXMCDi4fGwSaWEmoWi4Poknkw=" crossorigin=anonymous><link rel=stylesheet href=/css/palette/default.min.cfcbb0f894da76afbc5a46072e5cbec733a983f27395920a3cfdf6977053c351.css integrity="sha256-z8uw+JTadq+8WkYHLly+xzOpg/JzlZIKPP32l3BTw1E=" crossorigin=anonymous><script src=/js/main.86bb3d8e6f46df0fc97c2731e6b99175a13b87a4086acf578ff9b6992fcf32c1.js integrity="sha256-hrs9jm9G3w/JfCcx5rmRdaE7h6QIas9Xj/m2mS/PMsE=" crossorigin=anonymous></script><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH crossorigin=anonymous></head><body class=dark><main><div class="container pt-5"><div class="row mt-5 pt-5"></div><div class=post><header class=mb-4><h1 class=text-uppercase>Understanding_package_definitions</h1><div aria-label=breadcrumb><ol class=breadcrumb><li class="breadcrumb-item small"><time datetime=2025-05-14T19:19:10-04:00>May 14, 2025</time></li><li class="breadcrumb-item small">5 minutes</li></ol></div></header><article><h1 id=understanding-package-definitions-in-nix>Understanding Package Definitions in Nix</h1><p><strong>TOC</strong></p><ul><li><a href=#understanding-package-definitions-in-nix>Understanding Package Definitions in Nix</a><ul><li><a href=#the-journey-from-definition-to-package>The Journey from Definition to Package</a></li><li><a href=#skeleton-of-a-derivation>Skeleton of a Derivation</a></li><li><a href=#example-a-simple-hello-package-definition>Example: A Simple &ldquo;Hello&rdquo; Package Definition</a><ul><li><a href=#swaytools-package-definition>Swaytools Package Definition</a></li><li><a href=#resources>Resources</a></li></ul></li></ul></li></ul><figure><img src=/images/gruv1.png alt=gruvvy-bedroom width=700></figure><p>In Nix, the concept of a <strong>package</strong> can refer to two things:</p><ul><li><p>A collection of files and data that constitute a piece of software or an
artifact.</p></li><li><p>A Nix <strong>expression</strong> that describes how to create such a collection. This
expression acts as a blueprint before the package exists in a tangible form.</p></li></ul><p>The process begins with writing a <strong>package definition</strong> using the Nix language.
This definition contains the necessary instructions and metadata about the
software you intend to &ldquo;package.&rdquo;</p><h2 id=the-journey-from-definition-to-package>The Journey from Definition to Package</h2><ol><li><p><strong>Package Definition:</strong></p><ul><li><p>This is essentially a function written in the Nix language.</p></li><li><p>Nix language shares similarities with JSON but includes the crucial
addition of functions.</p></li><li><p>It acts as the blueprint for creating a package.</p></li></ul></li><li><p><strong>Derivation:</strong></p><ul><li><p>When the package definition is evaluated by Nix, it results in
a <strong>derivation</strong>.</p></li><li><p>A derivation is a concrete and detailed build plan.</p></li><li><p>It outlines the exact steps Nix needs to take: fetching source code,
building dependencies, compiling code, and ultimately producing the
desired output (the package).</p></li></ul></li><li><p><strong>Realization (Building the Package):</strong></p><ul><li><p>You don&rsquo;t get a pre-built &ldquo;package&rdquo; directly from the definition or the
derivation.</p></li><li><p>The package comes into being when Nix <strong>executes</strong> the derivation. This
process is often referred to as &ldquo;realizing&rdquo; the derivation.</p></li></ul></li></ol><p><strong>Analogy:</strong> Think of a package definition as an architectural blueprint, the
derivation as the detailed construction plan, and the realized package as the
finished building.</p><h2 id=skeleton-of-a-derivation>Skeleton of a Derivation</h2><p>The most basic derivation structure in Nix looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{ stdenv }:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>stdenv<span style=color:#f92672>.</span>mkDerivation { }
</span></span></code></pre></div><ul><li><p>This is a function that expects an attribute set containing <code>stdenv</code> as its
argument.</p></li><li><p>It then calls <code>stdenv.mkDerivation</code> (a function provided by <code>stdenv</code>) to
produce a derivation.</p></li><li><p>Currently, this derivation doesn&rsquo;t specify any build steps or outputs.</p></li><li><p>Further Reading:</p></li><li><p><a href=https://ryantm.github.io/nixpkgs/stdenv/stdenv/>The Standard Environment</a></p></li><li><p><a href=https://nixos.org/guides/nix-pills/19-fundamentals-of-stdenv.html>Fundamentals of Stdenv</a></p></li></ul><h2 id=example-a-simple-hello-package-definition>Example: A Simple &ldquo;Hello&rdquo; Package Definition</h2><p>Here&rsquo;s a package definition for the classic &ldquo;hello&rdquo; program:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># hello.nix</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  stdenv<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  fetchzip<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>}:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>stdenv<span style=color:#f92672>.</span>mkDerivation {
</span></span><span style=display:flex><span>  pname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;hello&#34;</span>;
</span></span><span style=display:flex><span>  version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;2.12.1&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  src <span style=color:#f92672>=</span> fetchzip {
</span></span><span style=display:flex><span>    url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;[https://ftp.gnu.org/gnu/hello/hello-2.12.1.tar.gz](https://ftp.gnu.org/gnu/hello/hello-2.12.1.tar.gz)&#34;</span>;
</span></span><span style=display:flex><span>    sha256 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><p>This is a Nix function that takes stdenv and fetchzip as arguments.</p></li><li><p>It uses <code>stdenv.mkDerivation</code> to define the build process for the &ldquo;hello&rdquo;
package.</p><ul><li><p><code>pname</code>: The package name.</p></li><li><p><code>version</code>: The package version.</p></li><li><p><code>src</code>: Specifies how to fetch the source code using <code>fetchzip</code>.</p></li></ul></li></ul><p><strong>Handling Dependencies: Importing Nixpkgs</strong></p><ul><li><p>If you try to build <code>hello.nix</code> directly with <code>nix-build hello.nix</code>, it will
fail because <code>stdenv</code> and <code>fetchzip</code> are part of Nixpkgs, which isn&rsquo;t included
in this isolated file.</p></li><li><p>To make this package definition work, you need to pass the correct arguments
(<code>stdenv</code>, <code>fetchzip</code>) to the function.</p></li></ul><p>The recommended approach is to create a <code>default.nix</code> file in the same
directory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># default.nix</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span>
</span></span><span style=display:flex><span>  nixpkgs <span style=color:#f92672>=</span> fetchTarball <span style=color:#e6db74>&#34;[https://github.com/NixOS/nixpkgs/tarball/nixos-24.05](https://github.com/NixOS/nixpkgs/tarball/nixos-24.05)&#34;</span>;
</span></span><span style=display:flex><span>  pkgs <span style=color:#f92672>=</span> <span style=color:#f92672>import</span> nixpkgs { config <span style=color:#f92672>=</span> {}; overlays <span style=color:#f92672>=</span> []; };
</span></span><span style=display:flex><span><span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  hello <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>callPackage <span style=color:#e6db74>./hello.nix</span> { };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><p>This <code>default.nix</code> imports Nixpkgs.</p></li><li><p>It then uses <code>pkgs.callPackage</code> to call the function in <code>hello.nix</code>, passing
the necessary dependencies from Nixpkgs.</p></li><li><p>You can now build the &ldquo;hello&rdquo; package using: <code>nix-build -A hello</code>. The
<code>-A</code> flag tells Nix to build the attribute named hello from the top-level
expression in default.nix.</p></li></ul><p><strong>Realizing the Derivation and Handling sha256</strong></p><ul><li><p><strong>Evaluation vs. Realization</strong>: While &ldquo;evaluate&rdquo; refers to Nix processing an
expression, &ldquo;realize&rdquo; often specifically means building a derivation and
producing its output in the Nix store.</p></li><li><p>When you first run <code>nix-build -A hello</code>, it will likely fail due to a missing
sha256 hash for the source file. Nix needs this hash for security and
reproducibility. The error message will provide the correct sha256 value.</p></li><li><p><strong>Example Error</strong>):</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  nix-build -A hello
</span></span><span style=display:flex><span>  error: hash mismatch in fixed-output derivation <span style=color:#e6db74>&#39;/nix/store/pd2kiyfa0c06giparlhd1k31bvllypbb-source.drv&#39;</span>:
</span></span><span style=display:flex><span>  specified: sha256-AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  got: sha256-1kJjhtlsAkpNB7f6tZEs+dbKd8z7KoNHyDHEJ0tmhnc<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  error: <span style=color:#ae81ff>1</span> dependencies of derivation <span style=color:#e6db74>&#39;/nix/store/b4mjwlv73nmiqgkdabsdjc4zq9gnma1l-hello-2.12.1.drv&#39;</span> failed to build
</span></span></code></pre></div><ul><li>Replace the empty <code>sha256 = "";</code> in <code>hello.nix</code> with the provided correct
value: <code>sha256 = "1kJjhtlsAkpNB7f6tZEs+dbKd8z7KoNHyDHEJ0tmhnc=";</code>.</li></ul><p><strong>Building and Running the Result</strong></p><p>After updating the <code>sha256</code>, you can successfully build the package:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build -A hello
</span></span></code></pre></div><p>The output will be a result symlink pointing to the built package in the Nix
store. You can then run the &ldquo;hello&rdquo; program:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./result/bin/hello
</span></span><span style=display:flex><span>Hello, world!
</span></span></code></pre></div><h3 id=swaytools-package-definition>Swaytools Package Definition</h3><p><strong>Example: The swaytools Package Definition</strong></p><p>Let&rsquo;s examine a more complex, real-world package definition from Nixpkgs:
<code>nixpkgs/pkgs/tools/wayland/swaytools/default.nix</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># default.nix</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  lib<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  setuptools<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  buildPythonApplication<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  fetchFromGitHub<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  slurp<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>}:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>buildPythonApplication <span style=color:#66d9ef>rec</span> {
</span></span><span style=display:flex><span>  pname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;swaytools&#34;</span>;
</span></span><span style=display:flex><span>  version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.1.2&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  format <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;pyproject&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  src <span style=color:#f92672>=</span> fetchFromGitHub {
</span></span><span style=display:flex><span>    owner <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;tmccombs&#34;</span>;
</span></span><span style=display:flex><span>    repo <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;swaytools&#34;</span>;
</span></span><span style=display:flex><span>    rev <span style=color:#f92672>=</span> version;
</span></span><span style=display:flex><span>    sha256 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;sha256-UoWK53B1DNmKwNLFwJW1ZEm9dwMOvQeO03+RoMl6M0Q=&#34;</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  nativeBuildInputs <span style=color:#f92672>=</span> [ setuptools ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  propagatedBuildInputs <span style=color:#f92672>=</span> [ slurp ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  meta <span style=color:#f92672>=</span> <span style=color:#66d9ef>with</span> lib; {
</span></span><span style=display:flex><span>    homepage <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://github.com/tmccombs/swaytools&#34;</span>;
</span></span><span style=display:flex><span>    description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Collection of simple tools for sway (and i3)&#34;</span>;
</span></span><span style=display:flex><span>    license <span style=color:#f92672>=</span> licenses<span style=color:#f92672>.</span>gpl3Only;
</span></span><span style=display:flex><span>    maintainers <span style=color:#f92672>=</span> <span style=color:#66d9ef>with</span> maintainers; [ atila ];
</span></span><span style=display:flex><span>    platforms <span style=color:#f92672>=</span> platforms<span style=color:#f92672>.</span>linux;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=breakdown-of-the-above-defaultnix>Breakdown of the Above default.nix</h3><p>1 <strong>Function Structure</strong>:</p><ul><li>The file starts with a function taking an attribute set of dependencies from
Nixpkgs: <code>{ lib, setuptools, buildPythonApplication, fetchFromGitHub, slurp }</code>
:.</li></ul><ol start=2><li><strong>Derivation Creation</strong>:</li></ol><ul><li>It calls <code>buildPythonApplication</code>, a specialized helper for Python packages
(similar to <code>stdenv.mkDerivation</code> but pre-configured for Python). The <code>rec</code>
keyword allows attributes within the derivation to refer to each other.</li></ul><ol start=3><li><strong>Package Metadata</strong>:</li></ol><ul><li><p><code>pname</code> and <code>version</code> define the package&rsquo;s name and version.</p></li><li><p>The <code>meta</code> attribute provides standard package information like the homepage,
description, license, maintainers, and supported platforms.</p></li></ul><ol start=4><li><strong>Source Specification</strong>:</li></ol><ul><li>The <code>src</code> attribute uses <code>fetchFromGitHub</code> to download the source code from
the specified repository and revision, along with its <code>sha256</code> hash for
verification.</li></ul><ol start=5><li><strong>Build and Runtime Dependencies</strong>:</li></ol><ul><li><p><code>nativeBuildInputs</code>: Lists tools required during the build process (e.g.,
<code>setuptools</code> for Python).</p></li><li><p><code>propagatedBuildInputs</code>: Lists dependencies needed at runtime (e.g., <code>slurp</code>).</p></li></ul><ol start=6><li><strong>Build Format</strong>:</li></ol><ul><li><code>format = "pyproject";</code> indicates that the package uses a <code>pyproject.toml</code>
file for its Python build configuration.</li></ul><p><strong>Integration within Nixpkgs</strong></p><ul><li><p><strong>Location</strong>: The swaytools definition resides in
<code>pkgs/tools/wayland/swaytools/default.nix</code>.</p></li><li><p><strong>Top-Level Inclusion</strong>: It&rsquo;s made available as a top-level package in
<code>pkgs/top-level/all-packages.nix</code> like this:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># all-packages.nix</span>
</span></span><span style=display:flex><span>swaytools <span style=color:#f92672>=</span> python3Packages<span style=color:#f92672>.</span>callPackage <span style=color:#e6db74>../tools/wayland/swaytools</span> { };
</span></span></code></pre></div><ul><li><code>python3Packages.callPackage</code> is used here because <code>swaytools</code> is a Python
package, and it ensures the necessary Python-related dependencies are
correctly passed to the <code>swaytools</code> definition.</li></ul><h3 id=resources>Resources</h3><ul><li><a href=https://nix.dev/tutorials/packaging-existing-software.html>Packaging Existing Software</a></li></ul></article><div class=row><div class=col-md><a href=https://saylesss88.github.io/posts/nix_repl_tips/><span>previous: </span><span>Nix_repl_tips</span></a></div><div class="col-md text-md-end"><a href=https://saylesss88.github.io/posts/nix_flakes_explained/><span>next: </span><span>Nix_flakes_explained</span></a></div></div></div></div><footer><div class="container mt-4 pb-1"><p class="small opacity-75"></p><p><a href=https://saylesss88.github.io//index.xml><img src=/images/rss.png alt="RSS Feed" width=24></a></p></div></footer></main><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js integrity=sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz crossorigin=anonymous></script></body></html>